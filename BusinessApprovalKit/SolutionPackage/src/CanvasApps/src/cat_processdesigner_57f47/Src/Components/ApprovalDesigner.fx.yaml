ApprovalDesigner As CanvasComponent:
    AddNode(Path As Number, Row As Number, StageIndex As Number, StageId As String):
        Path:
            Default: =100
        Row:
            Default: =100
        StageIndex:
            Default: =100
        StageId:
            Default: ="Text"
        ThisProperty:
            Default: ="Text"
    AddStage():
        ThisProperty:
            Default: ="Text"
    EditNode(NodeId As String, StageId As String):
        NodeId:
            Default: ="Text"
        StageId:
            Default: ="Text"
        ThisProperty:
            Default: ="Text"
    EditStage(StageId As String):
        StageId:
            Default: ="Text"
        ThisProperty:
            Default: ="Text"
    MoveStage(StageId As String, IsMoveUp As Boolean):
        StageId:
            Default: ="Text"
        IsMoveUp:
            Default: =true
        ThisProperty:
            Default: =100
    DesignerAutoHeight: |-
        =galProcessStages_1.Height + icoAddStage_1.Height + 5
        
        /*(galStageNodes.TemplateHeight * CountRows(galStageNodes.AllItems))  + galStageNodes.TemplatePadding + galProcessStages_1.TemplatePadding + 50 + If(CountRows(galStageNodes.AllItems) = 0, galProcessStages_1.TemplateHeight * CountRows(galProcessStages_1.AllItems))*/
    Fill: =RGBA(0, 0, 0, 0)
    Height: =600
    IsValid: =true//CountRows(Filter(galProcessStages_1.AllItems, !IsBlank(stageBackground.Tooltip))) = 0
    ProcessId: ="a4517557-c6f2-ed11-8848-0022482a91f4"
    TotalStages: =CountRows(galProcessStages_1.AllItems)
    Width: =1000
    X: =0
    Y: =0
    ZIndex: =1

    divStartTemplate As label:
        BorderColor: =RGBA(0, 0, 0, 0)
        BorderStyle: =BorderStyle.None
        BorderThickness: =2
        Color: =RGBA(51, 51, 51, 1)
        DisabledBorderColor: =RGBA(0, 0, 0, 0)
        DisabledColor: =RGBA(166, 166, 166, 1)
        FocusedBorderThickness: =4
        Font: =Font.'Segoe UI'
        Height: =0
        PaddingBottom: =0
        PaddingLeft: =0
        PaddingRight: =0
        PaddingTop: =0
        Size: =13
        Text: |-
            ="<div style='border: 1px solid #888;line-height:46px;height:46px;width:50px;word-wrap:normal;display:inline-block;text-align:center;vertical-align:middle;margin:2px;padding:0px 2px 4px 2px'><span style='line-height:11px;display:inline-block;vertical-align:middle'>"
        Visible: =false
        Width: =0
        X: =5
        Y: =40
        ZIndex: =1

    galProcessStages_1 As gallery.variableTemplateHeightGallery:
        AccessibleLabel: ="Process stages"
        BorderColor: =RGBA(166, 166, 166, 1)
        DelayItemLoading: =false//true
        Height: =galStageNodes.Height * Self.AllItemsCount + galStageConditions_1.Height* Self.AllItemsCount + Self.TemplatePadding + 50
        Items: |-
            =Filter(
                Filter('Business Approval Stages', 'Business Approval Stages (Views)'.'Active Business Approval Stages'),
                Process.'Business Approval Process' = GUID(Parent.ProcessId)
            )
            //"65d75041-777d-ee11-8179-0022482a91f4"
            //Parent.ProcessId
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        ShowNavigation: =true
        ShowScrollbar: =false
        TemplateSize: =280
        Visible: =CountRows(Self.AllItems) > 0
        Width: =Parent.Width - Self.X * 2
        ZIndex: =2

        stageBackground_1 As rectangle:
            BorderColor: |-
                =If(
                    CountRows(galStageNodes.AllItems) > 0, 
                    RGBA(105, 121, 126, 1),
                    RGBA(255, 0, 0, 1)
                )
            BorderThickness: =1
            DisplayMode: =DisplayMode.Disabled
            Fill: =RGBA(237, 237, 237, 1)
            FocusedBorderThickness: =4
            Height: |-
                =Max(
                    galStageNodes.Height + galStageNodes.Y,
                    lblNoNodeInStage_1.Y + lblNoNodeInStage_1.Height, 
                    galStageConditions_1.Y + galStageConditions_1.Height
                )
            HoverFill: =RGBA(105, 121, 126, 1)
            OnSelect: =
            PressedFill: =RGBA(105, 121, 126, 1)
            Tooltip: =If(Self.BorderColor = RGBA(255, 0, 0, 1), "Stage must have at least one node", Blank())
            Visible: =false
            Width: =Parent.TemplateWidth
            Y: =5
            ZIndex: =1

        icoEditStage_1 As icon.Edit:
            AccessibleLabel: ="Edit stage"
            BorderColor: =RGBA(166, 166, 166, 1)
            Color: =RGBA(105, 121, 126, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(220, 220, 220, 1)
            DisabledFill: =RGBA(0, 0, 0, 0)
            FocusedBorderThickness: =4
            Height: =30
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            HoverFill: =RGBA(0, 0, 0, 0)
            Icon: =Icon.Edit
            OnSelect: |-
                =ApprovalDesigner.EditStage(ThisItem.'Business Approval Stage')
                //Set(_selectedStage, ThisItem);Set(_currentStageIndex, ThisItem.Order);Navigate(scrApprovalStageEditor)
            PaddingBottom: =6
            PaddingLeft: =6
            PaddingRight: =6
            PaddingTop: =6
            PressedBorderColor: =RGBA(0, 0, 0, 0)
            PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            PressedFill: =RGBA(0, 0, 0, 0)
            Visible: =false
            Width: =30
            X: =Parent.TemplateWidth - 60
            Y: =stageBackground_1.Y
            ZIndex: =2

        icoToggleStage_1 As icon.Edit:
            AccessibleLabel: =If(Self.Icon = Icon.ChevronUp, "Hide stage", "Expand stage")
            BorderColor: =RGBA(166, 166, 166, 1)
            Color: =RGBA(105, 121, 126, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(220, 220, 220, 1)
            DisabledFill: =RGBA(0, 0, 0, 0)
            FocusedBorderThickness: =4
            Height: =30
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            HoverFill: =RGBA(0, 0, 0, 0)
            Icon: =If(ThisItem.'Business Approval Stage' in _collapsedStage.Value, Icon.ChevronDown, Icon.ChevronUp)
            OnSelect: |-
                =If(Self.Icon = Icon.ChevronUp, 
                    Collect(_collapsedStage, ThisItem.'Business Approval Stage'), 
                    RemoveIf(_collapsedStage, Value = ThisItem.'Business Approval Stage')
                )
            PaddingBottom: =6
            PaddingLeft: =6
            PaddingRight: =6
            PaddingTop: =6
            PressedBorderColor: =RGBA(0, 0, 0, 0)
            PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            PressedFill: =RGBA(0, 0, 0, 0)
            Width: =30
            X: =Parent.TemplateWidth - Self.Width
            Y: =stageBackground_1.Y
            ZIndex: =3

        icoMoveDown As icon.ArrowDown:
            AccessibleLabel: ="Move stage down"
            BorderColor: =RGBA(166, 166, 166, 1)
            Color: =RGBA(105, 121, 126, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(220, 220, 220, 1)
            DisabledFill: =RGBA(0, 0, 0, 0)
            DisplayMode: |-
                =//not allowed to move the first stage or last stage
                If(ThisItem.Order > 1 && ThisItem.Order < ApprovalDesigner.TotalStages, DisplayMode.Edit, DisplayMode.Disabled)
            FocusedBorderThickness: =4
            Height: =30
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            HoverFill: =RGBA(0, 0, 0, 0)
            OnSelect: =ApprovalDesigner.MoveStage(ThisItem.'Business Approval Stage', false)
            PaddingBottom: =6
            PaddingLeft: =6
            PaddingRight: =6
            PaddingTop: =6
            PressedBorderColor: =RGBA(0, 0, 0, 0)
            PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            PressedFill: =RGBA(0, 0, 0, 0)
            Tooltip: ="Move stage down"
            Visible: =false
            Width: =30
            X: =icoEditStage_1.X - Self.Width
            Y: =icoEditStage_1.Y
            ZIndex: =4

        icoMoveUp As icon.ArrowDown:
            AccessibleLabel: ="Move stage up"
            BorderColor: =RGBA(166, 166, 166, 1)
            Color: =RGBA(105, 121, 126, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(220, 220, 220, 1)
            DisabledFill: =RGBA(0, 0, 0, 0)
            DisplayMode: |-
                =//not allowed to move the first stage or second stage
                If(ThisItem.Order > 2, DisplayMode.Edit, DisplayMode.Disabled)
            FocusedBorderThickness: =4
            Height: =30
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            HoverFill: =RGBA(0, 0, 0, 0)
            Icon: =Icon.ArrowUp
            OnSelect: =ApprovalDesigner.MoveStage(ThisItem.'Business Approval Stage', true)
            PaddingBottom: =6
            PaddingLeft: =6
            PaddingRight: =6
            PaddingTop: =6
            PressedBorderColor: =RGBA(0, 0, 0, 0)
            PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            PressedFill: =RGBA(0, 0, 0, 0)
            Tooltip: ="Move stage up"
            Visible: =false
            Width: =30
            X: =icoMoveDown.X - Self.Width
            Y: =icoMoveDown.Y
            ZIndex: =5

        "stageBGElevation_1 As 'Fluent Elevation (1.0.22)'":
            DisplayMode: =DisplayMode.Edit
            Height: |-
                =Max(
                    galStageNodes.Height + galStageNodes.Y -2,
                    lblNoNodeInStage_1.Y + lblNoNodeInStage_1.Height -2, 
                    galStageConditions_1.Y + galStageConditions_1.Height -2
                )
            HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth16
            HoverFillColor: =AppTheme.palette.themeLight
            Width: =Parent.TemplateWidth - 10
            X: =5
            Y: =5
            ZIndex: =6

        stageBackGround_1 As groupContainer.manualLayoutContainer:
            BorderColor: |-
                =If(
                    CountRows(galStageNodes.AllItems) > 0, 
                    /*RGBA(105, 121, 126, 1)*/ColorValue(AppTheme.palette.themePrimary),
                    RGBA(255, 0, 0, 1)
                )
            BorderThickness: =1
            DropShadow: =DropShadow.Semilight
            Fill: =If(Self.BorderColor=RGBA(255, 0, 0, 1),ColorValue(AppTheme.palette.white), ColorFade(ColorValue(AppTheme.palette.themeLighterAlt),60%))//RGBA(237, 237, 237, 1) //ColorValue(AppTheme.palette.themeLighterAlt)
            Height: |-
                =Max(
                    galStageNodes.Height + galStageNodes.Y,
                    lblNoNodeInStage_1.Y + lblNoNodeInStage_1.Height, 
                    galStageConditions_1.Y + galStageConditions_1.Height
                )
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            Width: =Parent.TemplateWidth - Self.X -2
            X: =2
            Y: =5
            ZIndex: =7

        galStageNodes As gallery.galleryVertical:
            AccessibleLabel: ="Stage nodes"
            BorderColor: =RGBA(255, 0, 0, 1)
            DelayItemLoading: =true
            Height: =If(Self.Visible, CountRows(Self.AllItems) * (Self.TemplateHeight + (2*Self.TemplatePadding)), 0)
            Items: |-
                =AddColumns(
                    GroupBy(
                        SortByColumns(
                            Filter('Business Approval Nodes', Stage.'Business Approval Stage' = ThisItem.'Business Approval Stage'), 
                            "cat_rowindex"
                        ), "cat_rowindex", "Nodes"
                    ), "Paths", ThisItem.Paths
                )
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            ShowScrollbar: =false
            TemplatePadding: =0
            TemplateSize: =120
            Visible: =CountRows(Self.AllItems) > 0 && icoToggleStage_1.Icon = Icon.ChevronUp
            Width: =Parent.TemplateWidth
            Y: |-
                =If(ThisItem.'Stage Condition' = 'Business Approval Stage Condition'.None,
                    lblGalStageName_1.Height,
                    galStageConditions_1.Y + galStageConditions_1.Height
                )
            ZIndex: =8

            "elevationNodeBoxPath5 As 'Fluent Elevation (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =88
                HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth64
                HoverFillColor: =AppTheme.palette.themeLight
                Visible: =conNodeBoxPath5.Visible
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: =conNodeBoxPath5.X
                Y: =
                ZIndex: =1

            "elevationNodeBoxPath4 As 'Fluent Elevation (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =88
                HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth64
                HoverFillColor: =AppTheme.palette.themeLight
                Visible: =conNodeBoxPath4.Visible
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: =conNodeBoxPath4.X
                Y: =
                ZIndex: =2

            "elevationNodeBoxPath3 As 'Fluent Elevation (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =88
                HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth64
                HoverFillColor: =AppTheme.palette.themeLight
                Visible: =conNodeBoxPath3.Visible
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: =conNodeBoxPath3.X
                Y: =
                ZIndex: =3

            "elevationNodeBoxPath2 As 'Fluent Elevation (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =88
                HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth64
                HoverFillColor: =AppTheme.palette.themeLight
                Visible: =conNodeBoxPath2.Visible
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: =conNodeBoxPath2.X
                Y: =0
                ZIndex: =4

            "elevationNodeBoxPath1 As 'Fluent Elevation (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =88
                HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth64
                HoverFillColor: =AppTheme.palette.themeLight
                Visible: =conNodeBoxPath1.Visible
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: |-
                    =With({ pathWidth: Parent.Width / Coalesce(ThisItem.Paths,1)}, pathWidth / 2 - Self.Width / 2)
                Y: =0
                ZIndex: =5

            nodeLineCenter1_1 As rectangle:
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                DisabledFill: =RGBA(166, 166, 166, 1)
                Fill: =RGBA(128, 128, 128, 1)
                FocusedBorderThickness: =4
                Height: =28
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =false
                Width: =1
                X: =conNodeBoxPath1.X + conNodeBoxPath1.Width / 2//nodeBoxPath1.X + nodeBoxPath1.Width / 2
                Y: =nodeBoxPath1.Y + nodeBoxPath1.Height
                ZIndex: =6

            nodeBoxPath5 As rectangle:
                BorderColor: =RGBA(128, 128, 128, 1)
                BorderThickness: =1
                DisplayMode: =DisplayMode.Disabled
                Fill: =RGBA(255, 255, 255, 1)
                FocusedBorderThickness: =4
                Height: =88
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =false//!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 5))
                Width: =nodeBoxPath1.Width
                X: =665
                Y: =
                ZIndex: =7

            nodeBoxPath4 As rectangle:
                BorderColor: =RGBA(128, 128, 128, 1)
                BorderThickness: =1
                DisplayMode: =DisplayMode.Disabled
                Fill: =RGBA(255, 255, 255, 1)
                FocusedBorderThickness: =4
                Height: =88
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =false//!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 4))
                Width: =nodeBoxPath1.Width
                X: =665
                Y: =
                ZIndex: =8

            nodeBoxPath3 As rectangle:
                BorderColor: =RGBA(128, 128, 128, 1)
                BorderThickness: =1
                DisplayMode: =DisplayMode.Disabled
                Fill: =RGBA(255, 255, 255, 1)
                FocusedBorderThickness: =4
                Height: =88
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =false//!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 3))
                Width: =nodeBoxPath1.Width
                X: =665
                Y: =
                ZIndex: =9

            nodeBoxPath2 As rectangle:
                BorderColor: =RGBA(128, 128, 128, 1)
                BorderThickness: =1
                DisplayMode: =DisplayMode.Disabled
                Fill: =RGBA(255, 255, 255, 1)
                FocusedBorderThickness: =4
                Height: =88
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =false//!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 2))
                Width: =nodeBoxPath1.Width
                X: =665
                Y: =
                ZIndex: =10

            nodeBoxPath1 As rectangle:
                BorderColor: =RGBA(128, 128, 128, 1)
                BorderThickness: =1
                DisplayMode: =DisplayMode.Disabled
                Fill: =RGBA(255, 255, 255, 1)
                FocusedBorderThickness: =4
                Height: =88
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =false//!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 1))
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: |-
                    =With({ pathWidth: Parent.Width / Coalesce(ThisItem.Paths,1)}, pathWidth / 2 - Self.Width / 2)
                Y: =
                ZIndex: =11

            conNodeBoxPath5 As groupContainer.manualLayoutContainer:
                BorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(0, 0, 0, 1)
                BorderThickness: =1
                DropShadow: =DropShadow.Light
                Fill: =RGBA(255, 255, 255, 1)
                Height: =88
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                Visible: =!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 5))
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: |-
                    =With({pathWidth: Parent.Width / Coalesce(ThisItem.Paths,1)}, (4 * pathWidth) + (pathWidth/2  - Self.Width / 2))
                Y: =
                ZIndex: =12

            conNodeBoxPath4 As groupContainer.manualLayoutContainer:
                BorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(0, 0, 0, 1)
                BorderThickness: =1
                DropShadow: =DropShadow.Light
                Fill: =RGBA(255, 255, 255, 1)
                Height: =88
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                Visible: =!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 4))
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: |-
                    =With({pathWidth: Parent.Width / Coalesce(ThisItem.Paths,1)}, (3 * pathWidth) + (pathWidth/2  - Self.Width / 2))
                Y: =
                ZIndex: =13

            conNodeBoxPath3 As groupContainer.manualLayoutContainer:
                BorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(0, 0, 0, 1)
                BorderThickness: =1
                DropShadow: =DropShadow.Light
                Fill: =RGBA(255, 255, 255, 1)
                Height: =88
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                Visible: =!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 3))
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: |-
                    =With({pathWidth: Parent.Width / Coalesce(ThisItem.Paths,1)}, (2 * pathWidth) + (pathWidth/2  - Self.Width / 2))
                ZIndex: =14

            conNodeBoxPath2 As groupContainer.manualLayoutContainer:
                BorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(0, 0, 0, 1)
                BorderThickness: =1
                DropShadow: =DropShadow.Light
                Fill: =RGBA(255, 255, 255, 1)
                Height: =88
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                Visible: =!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 2))
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: |-
                    =With({pathWidth: Parent.Width / Coalesce(ThisItem.Paths,1)}, pathWidth + (pathWidth/2  - Self.Width / 2))
                ZIndex: =15

            conNodeBoxPath1 As groupContainer.manualLayoutContainer:
                BorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(0, 0, 0, 1)
                BorderThickness: =1
                DropShadow: =DropShadow.Light
                Fill: =RGBA(255, 255, 255, 1)
                Height: =88
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                Visible: =!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 1))//nodeBoxPath1.Visible
                Width: =Min(300, (Parent.TemplateWidth / Coalesce(ThisItem.Paths,1)) - 4)
                X: |-
                    =With({ pathWidth: Parent.Width / Coalesce(ThisItem.Paths,1)}, pathWidth / 2 - Self.Width / 2)
                ZIndex: =16

            btnAddNodePath5 As button:
                BorderColor: =RGBA(74, 85, 88, 1)
                BorderThickness: =1
                Color: =ColorValue(AppTheme.palette.white)//RGBA(74, 85, 88, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(204, 204, 204, 1)
                FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =20
                HoverBorderColor: =ColorValue(AppTheme.palette.themePrimary) //RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(105, 121, 126, 1), -10%)
                OnSelect: |-
                    =With({ stage: First(ThisItem.Nodes).Stage },
                        ApprovalDesigner.AddNode(5, ThisItem.cat_rowindex + 1, stage.Order, stage.'Business Approval Stage' )
                    )
                PaddingBottom: =3
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                RadiusBottomLeft: =20
                RadiusBottomRight: =20
                RadiusTopLeft: =20
                RadiusTopRight: =20
                Size: =12
                Text: ="+"
                Visible: =conNodeBoxPath5.Visible
                Width: =20
                X: =conNodeBoxPath5.X + conNodeBoxPath5.Width / 2 - Self.Width / 2
                Y: =nodeLineCenter1_1.Y + nodeLineCenter1_1.Height / 2 - Self.Height / 2
                ZIndex: =17

            btnAddNodePath4 As button:
                BorderColor: =RGBA(74, 85, 88, 1)
                BorderThickness: =1
                Color: =ColorValue(AppTheme.palette.white)//RGBA(74, 85, 88, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(204, 204, 204, 1)
                FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =20
                HoverBorderColor: =ColorValue(AppTheme.palette.themePrimary) //RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(105, 121, 126, 1), -10%)
                OnSelect: |-
                    =With({ stage: First(ThisItem.Nodes).Stage },
                        ApprovalDesigner.AddNode(4, ThisItem.cat_rowindex + 1, stage.Order, stage.'Business Approval Stage' )
                    )
                PaddingBottom: =3
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                RadiusBottomLeft: =20
                RadiusBottomRight: =20
                RadiusTopLeft: =20
                RadiusTopRight: =20
                Size: =12
                Text: ="+"
                Visible: =conNodeBoxPath4.Visible
                Width: =20
                X: =conNodeBoxPath4.X + conNodeBoxPath4.Width / 2 - Self.Width / 2
                Y: =nodeLineCenter1_1.Y + nodeLineCenter1_1.Height / 2 - Self.Height / 2
                ZIndex: =18

            btnAddNodePath3 As button:
                BorderColor: =RGBA(74, 85, 88, 1)
                BorderThickness: =1
                Color: =ColorValue(AppTheme.palette.white)//RGBA(74, 85, 88, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(204, 204, 204, 1)
                FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =20
                HoverBorderColor: =ColorValue(AppTheme.palette.themePrimary) //RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(105, 121, 126, 1), -10%)
                OnSelect: |-
                    =With({ stage: First(ThisItem.Nodes).Stage },
                        ApprovalDesigner.AddNode(3, ThisItem.cat_rowindex + 1, stage.Order, stage.'Business Approval Stage' )
                    )
                PaddingBottom: =3
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                RadiusBottomLeft: =20
                RadiusBottomRight: =20
                RadiusTopLeft: =20
                RadiusTopRight: =20
                Size: =12
                Text: ="+"
                Visible: =conNodeBoxPath3.Visible
                Width: =20
                X: =conNodeBoxPath3.X + conNodeBoxPath3.Width / 2 - Self.Width / 2
                Y: =nodeLineCenter1_1.Y + nodeLineCenter1_1.Height / 2 - Self.Height / 2
                ZIndex: =19

            btnAddNodePath2 As button:
                BorderColor: =RGBA(74, 85, 88, 1)
                BorderThickness: =1
                Color: =ColorValue(AppTheme.palette.white)//RGBA(74, 85, 88, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(204, 204, 204, 1)
                FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =20
                HoverBorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(105, 121, 126, 1), -10%)
                OnSelect: |-
                    =With({ stage: First(ThisItem.Nodes).Stage },
                        ApprovalDesigner.AddNode(2, ThisItem.cat_rowindex + 1, stage.Order, stage.'Business Approval Stage')
                    )
                PaddingBottom: =3
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                RadiusBottomLeft: =20
                RadiusBottomRight: =20
                RadiusTopLeft: =20
                RadiusTopRight: =20
                Size: =12
                Text: ="+"
                Visible: =conNodeBoxPath2.Visible
                Width: =20
                X: =conNodeBoxPath2.X + conNodeBoxPath2.Width / 2 - Self.Width / 2
                Y: =nodeLineCenter1_1.Y + nodeLineCenter1_1.Height / 2 - Self.Height / 2
                ZIndex: =20

            btnAddNodePath1 As button:
                BorderColor: =RGBA(74, 85, 88, 1)
                BorderThickness: =1
                Color: =ColorValue(AppTheme.palette.white)//RGBA(74, 85, 88, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(204, 204, 204, 1)
                FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =20
                HoverBorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorValue(AppTheme.palette.themePrimary)//ColorFade(RGBA(105, 121, 126, 1), -10%)
                OnSelect: |-
                    =With({ stage: First(ThisItem.Nodes).Stage },
                        ApprovalDesigner.AddNode(1, ThisItem.cat_rowindex + 1, stage.Order, stage.'Business Approval Stage')
                    )
                PaddingBottom: =3
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                RadiusBottomLeft: =20
                RadiusBottomRight: =20
                RadiusTopLeft: =20
                RadiusTopRight: =20
                Size: =12
                Text: ="+"
                Tooltip: ="Add Node"
                Visible: =conNodeBoxPath1.Visible
                Width: =20
                X: =conNodeBoxPath1.X + conNodeBoxPath1.Width / 2 - Self.Width / 2
                Y: =nodeLineCenter1_1.Y + nodeLineCenter1_1.Height / 2 - Self.Height / 2
                ZIndex: =21

            lblNodeApproversPath5 As htmlViewer:
                Color: =RGBA(128, 128, 128, 1)
                Font: =Font.'Segoe UI'
                Height: =60
                HtmlText: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 5)},
                        With({ nodeId: node.'Business Approval Node' }, "<div style='overflow:auto;margin:1px;height:54px;color:black;text-align:center'>" &
                            If(node.'Node Condition' = 'Business Approval Stage Condition'.None,
                                If(IsBlank(node.'Go To Stage'),    
                                    //show approvers              
                                    Concat(ForAll(Split(node.Approvers, ", "), {Result: ThisRecord.Value}), divStartTemplate.Text & Result & "</span></div>"),
                                    //show go to stage
                                    divStartTemplate.Text & "Go to <br/><b>" & node.'Go To Stage'.Name & "</b></span></div>"
                                ),
                    
                                //show conditions        
                                Concat(
                                    ShowColumns(
                                        Filter('Business Approval Conditions', Node.'Business Approval Node' = nodeId),
                                        "cat_conditionvaluedisplay", "cat_GoToStage"
                                    ), 
                                    divStartTemplate.Text & If(Len(cat_conditionvaluedisplay) > 0, "<b>" & cat_conditionvaluedisplay & "</b><br/>") & "Go to <br/><b>" & 
                                    cat_GoToStage.Name & "</b></span></div>"
                                )    
                            )
                        & "</div>")
                    )
                OnSelect: =
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Size: =7
                Visible: =conNodeBoxPath5.Visible
                Width: =nodeBoxPath1.Width
                X: =conNodeBoxPath5.X
                Y: =lblNodeApproversPath1.Y
                ZIndex: =22

            lblNodeApproversPath4 As htmlViewer:
                Color: =RGBA(128, 128, 128, 1)
                Font: =Font.'Segoe UI'
                Height: =60
                HtmlText: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 4)},
                        With({ nodeId: node.'Business Approval Node' }, "<div style='overflow:auto;margin:1px;height:54px;color:black;text-align:center'>" &
                            If(node.'Node Condition' = 'Business Approval Stage Condition'.None,
                                If(IsBlank(node.'Go To Stage'),    
                                    //show approvers              
                                    Concat(ForAll(Split(node.Approvers, ", "), {Result: ThisRecord.Value}), divStartTemplate.Text & Result & "</span></div>"),
                                    //show go to stage
                                    divStartTemplate.Text & "Go to <br/><b>" & node.'Go To Stage'.Name & "</b></span></div>"
                                ),
                    
                                //show conditions        
                                Concat(
                                    ShowColumns(
                                        Filter('Business Approval Conditions', Node.'Business Approval Node' = nodeId),
                                        "cat_conditionvaluedisplay", "cat_GoToStage"
                                    ), 
                                    divStartTemplate.Text & If(Len(cat_conditionvaluedisplay) > 0, "<b>" & cat_conditionvaluedisplay & "</b><br/>") & "Go to <br/><b>" & 
                                    cat_GoToStage.Name & "</b></span></div>"
                                )    
                            )
                        & "</div>")
                    )
                OnSelect: =
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Size: =7
                Visible: =conNodeBoxPath4.Visible
                Width: =nodeBoxPath1.Width
                X: =conNodeBoxPath4.X
                Y: =lblNodeApproversPath1.Y
                ZIndex: =23

            lblNodeApproversPath3 As htmlViewer:
                Color: =RGBA(128, 128, 128, 1)
                Font: =Font.'Segoe UI'
                Height: =60
                HtmlText: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 3)},
                        With({ nodeId: node.'Business Approval Node' }, "<div style='overflow:auto;margin:1px;height:54px;color:black;text-align:center'>" &
                            If(node.'Node Condition' = 'Business Approval Stage Condition'.None,
                                If(IsBlank(node.'Go To Stage'),    
                                    //show approvers              
                                    Concat(ForAll(Split(node.Approvers, ", "), {Result: ThisRecord.Value}), divStartTemplate.Text & Result & "</span></div>"),
                                    //show go to stage
                                    divStartTemplate.Text & "Go to <br/><b>" & node.'Go To Stage'.Name & "</b></span></div>"
                                ),
                    
                                //show conditions        
                                Concat(
                                    ShowColumns(
                                        Filter('Business Approval Conditions', Node.'Business Approval Node' = nodeId),
                                        "cat_conditionvaluedisplay", "cat_GoToStage"
                                    ), 
                                    divStartTemplate.Text & If(Len(cat_conditionvaluedisplay) > 0, "<b>" & cat_conditionvaluedisplay & "</b><br/>") & "Go to <br/><b>" & 
                                    cat_GoToStage.Name & "</b></span></div>"
                                )    
                            )
                        & "</div>")
                    )
                OnSelect: =
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Size: =7
                Visible: =conNodeBoxPath3.Visible
                Width: =nodeBoxPath1.Width
                X: =conNodeBoxPath3.X
                Y: =lblNodeApproversPath1.Y
                ZIndex: =24

            lblNodeApproversPath2 As htmlViewer:
                Color: =RGBA(128, 128, 128, 1)
                Font: =Font.'Segoe UI'
                Height: =60
                HtmlText: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 2)},
                        With({ nodeId: node.'Business Approval Node' }, "<div style='overflow:auto;margin:1px;height:54px;color:black;text-align:center'>" &
                            If(node.'Node Condition' = 'Business Approval Stage Condition'.None,
                                If(IsBlank(node.'Go To Stage'),    
                                    //show approvers              
                                    Concat(ForAll(Split(node.Approvers, ", "), {Result: ThisRecord.Value}), divStartTemplate.Text & Result & "</span></div>"),
                                    //show go to stage
                                    divStartTemplate.Text & "Go to <br/><b>" & node.'Go To Stage'.Name & "</b></span></div>"
                                ),
                    
                                //show conditions        
                                Concat(
                                    ShowColumns(
                                        Filter('Business Approval Conditions', Node.'Business Approval Node' = nodeId),
                                        "cat_conditionvaluedisplay", "cat_GoToStage"
                                    ), 
                                    divStartTemplate.Text & If(Len(cat_conditionvaluedisplay) > 0, "<b>" & cat_conditionvaluedisplay & "</b><br/>") & "Go to <br/><b>" & 
                                    cat_GoToStage.Name & "</b></span></div>"
                                )    
                            )
                        & "</div>")
                    )
                OnSelect: =
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Size: =7
                Visible: =conNodeBoxPath2.Visible
                Width: =nodeBoxPath1.Width
                X: =conNodeBoxPath2.X
                Y: =lblNodeApproversPath1.Y
                ZIndex: =25

            lblNodeApproversPath1 As htmlViewer:
                Color: =RGBA(128, 128, 128, 1)
                Font: =Font.'Segoe UI'
                Height: =60
                HtmlText: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 1)},
                        With({ nodeId: node.'Business Approval Node' }, "<div style='border:4px;overflow:hidden;margin:1px;height:55px;color:black;text-align:center;'>" &
                            If(node.'Node Condition' = 'Business Approval Stage Condition'.None,
                                If(IsBlank(node.'Go To Stage'),    
                                    //show approvers              
                                    Concat(
                                        ForAll(Split(node.Approvers, ", "),
                                            {Result: ThisRecord.Value}), $"{ divStartTemplate.Text }{ Result }</span></div>"
                                        ),
                                    //show go to stage
                                    $"{ divStartTemplate.Text }Go to <br/><b>{ node.'Go To Stage'.Name }</b></span></div>"
                                ),
                    
                                //show conditions        
                                Concat(
                                    ShowColumns(
                                        Filter('Business Approval Conditions', Node.'Business Approval Node' = nodeId),
                                        "cat_conditionvaluedisplay", "cat_GoToStage"
                                    ), 
                                    divStartTemplate.Text & If(Len(cat_conditionvaluedisplay) > 0, $"<b>{ cat_conditionvaluedisplay }</b><br/>") & $"Go to <br/><b>{ cat_GoToStage.Name }</b></span></div>"
                                )    
                            )
                        & "</div>")
                    )
                OnSelect: =
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Size: =7
                Visible: =!IsBlank(LookUp(ThisItem.Nodes, 'Path Index' = 1))//nodeBoxPath1.Visible
                Width: =conNodeBoxPath1.Width
                X: =conNodeBoxPath1.X
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height
                ZIndex: =26

            lblNodeNamePath5 As label:
                Align: =Align.Center
                BorderColor: =RGBA(105, 121, 126, 1)
                Color: =RGBA(255, 255, 255, 1)//RGBA(51, 51, 51, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Fill: =ColorValue(AppTheme.palette.themeSecondary)//RGBA(225, 228, 229, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =28
                OnSelect: =
                Size: =9
                Text: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 5)},
                        If(node.'Node Condition' = 'Business Approval Stage Condition'.None, 
                            node.Name, "If " & Coalesce(node.'Source Data Name Value', node.'Source Data Type') & " " & node.Operand
                        )
                    )
                Tooltip: =Self.Text
                Visible: =conNodeBoxPath5.Visible //nodeBoxPath5.Visible
                Width: =nodeBoxPath1.Width  + 1
                Wrap: =false
                X: =conNodeBoxPath5.X - 1
                Y: =lblNodeNamePath1.Y
                ZIndex: =27

            lblNodeNamePath4 As label:
                Align: =Align.Center
                BorderColor: =RGBA(105, 121, 126, 1)
                Color: =RGBA(255, 255, 255, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Fill: =ColorValue(AppTheme.palette.themeSecondary)//RGBA(225, 228, 229, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =28
                OnSelect: =
                Size: =9
                Text: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 4)},
                        If(node.'Node Condition' = 'Business Approval Stage Condition'.None, 
                            node.Name, "If " & Coalesce(node.'Source Data Name Value', node.'Source Data Type') & " " & node.Operand
                        )
                    )
                Tooltip: =Self.Text
                Visible: =conNodeBoxPath4.Visible //nodeBoxPath4.Visible
                Width: =nodeBoxPath1.Width  + 1
                Wrap: =false
                X: =conNodeBoxPath4.X - 1
                Y: =lblNodeNamePath1.Y
                ZIndex: =28

            lblNodeNamePath3 As label:
                Align: =Align.Center
                BorderColor: =RGBA(105, 121, 126, 1)
                Color: =RGBA(255, 255, 255, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Fill: =ColorValue(AppTheme.palette.themeSecondary)//RGBA(225, 228, 229, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =28
                OnSelect: =
                Size: =9
                Text: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 3)},
                        If(node.'Node Condition' = 'Business Approval Stage Condition'.None, 
                            node.Name, "If " & Coalesce(node.'Source Data Name Value', node.'Source Data Type') & " " & node.Operand
                        )
                    )
                Tooltip: =Self.Text
                Visible: =conNodeBoxPath3.Visible //nodeBoxPath3.Visible
                Width: =nodeBoxPath1.Width  + 1
                Wrap: =false
                X: =conNodeBoxPath3.X - 1
                Y: =lblNodeNamePath1.Y
                ZIndex: =29

            lblNodeNamePath2 As label:
                Align: =Align.Center
                BorderColor: =RGBA(105, 121, 126, 1)
                Color: =RGBA(255, 255, 255, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Fill: =ColorFade(ColorValue(AppTheme.palette.themeSecondary),30%)//RGBA(225, 228, 229, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =28
                OnSelect: =
                Size: =9
                Text: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 2)},
                        If(node.'Node Condition' = 'Business Approval Stage Condition'.None, 
                            node.Name, "If " & Coalesce(node.'Source Data Name Value', node.'Source Data Type') & " " & node.Operand
                        )
                    )
                Tooltip: =Self.Text
                Visible: =conNodeBoxPath2.Visible  //nodeBoxPath2.Visible
                Width: =conNodeBoxPath2.Width 
                Wrap: =false
                X: =conNodeBoxPath2.X 
                Y: =conNodeBoxPath2.Y 
                ZIndex: =30

            lblNodeNamePath1 As label:
                Align: =Align.Center
                BorderColor: =RGBA(105, 121, 126, 1)
                Color: =RGBA(255, 255, 255, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Fill: =ColorFade(ColorValue(AppTheme.palette.themeSecondary),30%)//RGBA(225, 228, 229, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =28
                OnSelect: =
                Size: =9
                Text: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 1)},   
                        If(node.'Node Condition' = 'Business Approval Stage Condition'.None, 
                            node.Name, "If " & Coalesce(node.'Source Data Name Value', node.'Source Data Type') & " " & node.Operand
                        )
                    )
                Tooltip: =Self.Text
                Visible: =conNodeBoxPath1.Visible //nodeBoxPath1.Visible
                Width: =conNodeBoxPath1.Width 
                Wrap: =false
                X: =conNodeBoxPath1.X 
                Y: =conNodeBoxPath1.Y 
                ZIndex: =31

            icoEditNodePath5 As icon.Edit:
                AccessibleLabel: =$"Edit node { lblNodeNamePath5.Text }"
                BorderColor: =RGBA(166, 166, 166, 1)
                Color: =RGBA(105, 121, 126, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(220, 220, 220, 1)
                DisabledFill: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =4
                Height: =30
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                HoverFill: =RGBA(0, 0, 0, 0)
                Icon: =Icon.Edit
                OnSelect: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 5) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                PaddingBottom: =8
                PaddingLeft: =8
                PaddingRight: =8
                PaddingTop: =8
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                PressedFill: =RGBA(0, 0, 0, 0)
                Tooltip: =
                Visible: =nodeBoxPath5.Visible
                Width: =30
                X: =935
                Y: =icoEditNodePath1.Y
                ZIndex: =32

            icoEditNodePath4 As icon.Edit:
                AccessibleLabel: =$"Edit node { lblNodeNamePath4.Text }"
                BorderColor: =RGBA(166, 166, 166, 1)
                Color: =RGBA(105, 121, 126, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(220, 220, 220, 1)
                DisabledFill: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =4
                Height: =30
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                HoverFill: =RGBA(0, 0, 0, 0)
                Icon: =Icon.Edit
                OnSelect: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 4) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                PaddingBottom: =8
                PaddingLeft: =8
                PaddingRight: =8
                PaddingTop: =8
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                PressedFill: =RGBA(0, 0, 0, 0)
                Tooltip: =
                Visible: =nodeBoxPath4.Visible
                Width: =30
                X: =935
                Y: =icoEditNodePath1.Y
                ZIndex: =33

            icoEditNodePath3 As icon.Edit:
                AccessibleLabel: =$"Edit node { lblNodeNamePath3.Text }"
                BorderColor: =RGBA(166, 166, 166, 1)
                Color: =RGBA(105, 121, 126, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(220, 220, 220, 1)
                DisabledFill: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =4
                Height: =30
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                HoverFill: =RGBA(0, 0, 0, 0)
                Icon: =Icon.Edit
                OnSelect: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 3) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                PaddingBottom: =8
                PaddingLeft: =8
                PaddingRight: =8
                PaddingTop: =8
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                PressedFill: =RGBA(0, 0, 0, 0)
                Tooltip: =
                Visible: =nodeBoxPath3.Visible
                Width: =30
                X: =935
                Y: =icoEditNodePath1.Y
                ZIndex: =34

            icoEditNodePath2 As icon.Edit:
                AccessibleLabel: =$"Edit node { lblNodeNamePath2.Text }"
                BorderColor: =RGBA(166, 166, 166, 1)
                Color: =RGBA(105, 121, 126, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(220, 220, 220, 1)
                DisabledFill: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =4
                Height: =30
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                HoverFill: =RGBA(0, 0, 0, 0)
                Icon: =Icon.Edit
                OnSelect: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 2) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                PaddingBottom: =8
                PaddingLeft: =8
                PaddingRight: =8
                PaddingTop: =8
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                PressedFill: =RGBA(0, 0, 0, 0)
                Tooltip: =
                Visible: =nodeBoxPath2.Visible
                Width: =30
                X: =935
                Y: =icoEditNodePath1.Y
                ZIndex: =35

            icoEditNodePath1 As icon.Edit:
                AccessibleLabel: =$"Edit node { lblNodeNamePath1.Text }"
                BorderColor: =RGBA(166, 166, 166, 1)
                Color: =RGBA(105, 121, 126, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(220, 220, 220, 1)
                DisabledFill: =RGBA(0, 0, 0, 0)
                FocusedBorderThickness: =4
                Height: =30
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                HoverFill: =RGBA(0, 0, 0, 0)
                Icon: =Icon.Edit
                OnSelect: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 1) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                PaddingBottom: =8
                PaddingLeft: =8
                PaddingRight: =8
                PaddingTop: =8
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                PressedFill: =RGBA(0, 0, 0, 0)
                Tooltip: =
                Visible: =false//nodeBoxPath1.Visible
                Width: =30
                X: =nodeBoxPath1.X + nodeBoxPath1.Width - Self.Width
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =36

            "icoCKEditNodePath1_1 As 'Fluent Icon (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                HoverFillColor: =AppTheme.palette.themePrimary
                IconColor: =AppTheme.palette.white
                IconName: ="Edit"
                OnChange: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 1) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Tooltip: ="Edit " & lblNodeNamePath1.Text &" node"
                Visible: =false
                Width: =25
                X: =nodeBoxPath1.X + nodeBoxPath1.Width - Self.Width
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =37

            "icoCKEditNodePath2 As 'Fluent Icon (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                HoverFillColor: =AppTheme.palette.themePrimary
                IconColor: =AppTheme.palette.white
                IconName: ="Edit"
                OnChange: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 2) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Tooltip: ="Edit " & lblNodeNamePath1.Text &" node"
                Visible: =false
                Width: =25
                X: =conNodeBoxPath2.X + conNodeBoxPath2.Width - Self.Width
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =38

            "icoCKEditNodePath3 As 'Fluent Icon (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                HoverFillColor: =AppTheme.palette.themePrimary
                IconColor: =AppTheme.palette.white
                IconName: ="Edit"
                OnChange: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 4) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Tooltip: ="Edit " & lblNodeNamePath1.Text &" node"
                Visible: =false
                Width: =25
                X: =conNodeBoxPath3.X + conNodeBoxPath3.Width - Self.Width
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =39

            "icoCKEditNodePath4 As 'Fluent Icon (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                HoverFillColor: =AppTheme.palette.themePrimary
                IconColor: =AppTheme.palette.white
                IconName: ="Edit"
                OnChange: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 5) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Tooltip: ="Edit " & lblNodeNamePath1.Text &" node"
                Visible: =false
                Width: =25
                X: =conNodeBoxPath4.X + conNodeBoxPath4.Width - Self.Width
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =40

            "icoCKEditNodePath5 As 'Fluent Icon (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                HoverFillColor: =AppTheme.palette.themePrimary
                IconColor: =AppTheme.palette.white
                IconName: ="Edit"
                OnChange: |-
                    =With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 1) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    )
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Tooltip: ="Edit " & lblNodeNamePath1.Text &" node"
                Visible: =false
                Width: =25
                X: =conNodeBoxPath5.X + conNodeBoxPath5.Width - Self.Width
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =41

            "commandbarCKEditNode2 As 'Fluent Command Bar (1.0.22)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                Items: |-
                    =Table(
                       {
                            ItemKey: "edit",
                            ItemDisplayName: "Edit Node",
                            ItemIconName: "Edit"
                        },
                        {
                            ItemKey: "delete",
                            ItemDisplayName: "Delete Node",
                            ItemIconName: "Delete"
                        }
                    )
                OnChange: =
                OnSelect: |-
                    =Switch(
                        Self.Selected.ItemKey,
                        "edit",
                        With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 2) },
                            ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                        ),
                        "delete",
                        Set(_showConfirmNode,true);
                        Set(_selectedNode,LookUp(ThisItem.Nodes, 'Path Index' = 2));
                        Set(confirmMessageNodeDelete,"Deleting node - " & _selectedNode.Name & ". This cannot be undone. Are you sure?");
                        //
                            //increment node index for any nodes after this node in this path, if exists
                            UpdateIf('Business Approval Nodes', 
                                'Path Index' = _selectedNode.'Path Index' && 'Row Index' >= _selectedNode.'Row Index' &&
                                ThisRecord.'Business Approval Node' <> _selectedNode.'Business Approval Node' &&
                                Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage', 
                                { 'Row Index': ThisRecord.'Row Index' + 1 }
                            );
                    
                            If(CountRows(_nodeApprovers) > 0 || CountRows(_removedApprovers) > 0,
                                Concurrent(
                                    //unrelate removed approvers
                                    Trace("_removedApprovers count: " & CountRows(_removedApprovers), TraceSeverity.Information);
                                    ForAll(_removedApprovers As appr,
                                        Unrelate(_selectedNode.'Business Approvers', LookUp('Business Approvers', 'Business Approver' = appr.Value))
                                    );
                                    Clear(_removedApprovers),
                                    
                                    //add newly added approvers to approver table if does not exist, otherwise update and then relate to selected node
                                    With({ addedApprovers: Filter(_nodeApprovers, IsBlank('Business Approver'))},
                                        Trace("newly added approvers count: " & CountRows(addedApprovers), TraceSeverity.Information);
                                        ForAll(addedApprovers As appr, 
                                            Relate(_selectedNode.'Business Approvers',
                                                Patch('Business Approvers', 
                                                    Coalesce(LookUp('Business Approvers', 'Approver Id' = appr.'Approver Id'), Defaults('Business Approvers')),
                                                    { 
                                                        Name: 
                                                            If(
                                                                appr.'Dynamic Approver Type' = 
                                                                'Business Approval Dynamic Approver Type'.'Manager of [Request data field]', 
                                                                "Manager of " & appr.'Request Data'.Name,
                    
                                                                appr.'Dynamic Approver Type' =
                                                                'Business Approval Dynamic Approver Type'.'Use Request Data Field',
                                                                appr.'Request Data'.Name,
                    
                                                                appr.Name
                                                            ),
                                                        'Approver Id': appr.'Approver Id', 'Approver Type': appr.'Approver Type',
                                                        'Dynamic Approver Type': appr.'Dynamic Approver Type', 'Request Data': appr.'Request Data'
                                                    }
                                                )
                                            )
                                        )
                                    )
                                );
                    
                                //refresh selected node reference
                                Refresh('Business Approval Nodes');
                                Set(_selectedNode, LookUp('Business Approval Nodes', 'Business Approval Node' = _selectedNode.'Business Approval Node'))
                            );
                            Set(_isBusy, false);
                    )
                Theme: =AppThemeJson
                Visible: =conNodeBoxPath2.Visible 
                Width: =25
                X: =conNodeBoxPath2.X + conNodeBoxPath2.Width - Self.Width - 5
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =42

            "commandbarCKEditNode3 As 'Fluent Command Bar (1.0.22)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                Items: |-
                    =Table(
                       {
                            ItemKey: "edit",
                            ItemDisplayName: "Edit Node",
                            ItemIconName: "Edit"
                        },
                        {
                            ItemKey: "delete",
                            ItemDisplayName: "Delete Node",
                            ItemIconName: "Delete"
                        }
                    )
                OnChange: =
                OnSelect: |-
                    =Switch(
                        Self.Selected.ItemKey,
                        "edit",
                        With(
                            {
                                node: LookUp(
                                    ThisItem.Nodes,
                                    'Path Index' = 3
                                )
                            },
                            ApprovalDesigner.EditNode(
                                node.'Business Approval Node',
                                node.Stage.'Business Approval Stage'
                            )
                        ),
                        "delete",
                        Set(_showConfirmNode,true);
                        Set(_selectedNode,LookUp(ThisItem.Nodes, 'Path Index' = 3));
                        Set(confirmMessageNodeDelete,"Deleting node - " & _selectedNode.Name & ". This cannot be undone. Are you sure?");
                        //
                            //increment node index for any nodes after this node in this path, if exists
                            UpdateIf('Business Approval Nodes', 
                                'Path Index' = _selectedNode.'Path Index' && 'Row Index' >= _selectedNode.'Row Index' &&
                                ThisRecord.'Business Approval Node' <> _selectedNode.'Business Approval Node' &&
                                Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage', 
                                { 'Row Index': ThisRecord.'Row Index' + 1 }
                            );
                    
                            If(CountRows(_nodeApprovers) > 0 || CountRows(_removedApprovers) > 0,
                                Concurrent(
                                    //unrelate removed approvers
                                    Trace("_removedApprovers count: " & CountRows(_removedApprovers), TraceSeverity.Information);
                                    ForAll(_removedApprovers As appr,
                                        Unrelate(_selectedNode.'Business Approvers', LookUp('Business Approvers', 'Business Approver' = appr.Value))
                                    );
                                    Clear(_removedApprovers),
                                    
                                    //add newly added approvers to approver table if does not exist, otherwise update and then relate to selected node
                                    With({ addedApprovers: Filter(_nodeApprovers, IsBlank('Business Approver'))},
                                        Trace("newly added approvers count: " & CountRows(addedApprovers), TraceSeverity.Information);
                                        ForAll(addedApprovers As appr, 
                                            Relate(_selectedNode.'Business Approvers',
                                                Patch('Business Approvers', 
                                                    Coalesce(LookUp('Business Approvers', 'Approver Id' = appr.'Approver Id'), Defaults('Business Approvers')),
                                                    { 
                                                        Name: 
                                                            If(
                                                                appr.'Dynamic Approver Type' = 
                                                                'Business Approval Dynamic Approver Type'.'Manager of [Request data field]', 
                                                                "Manager of " & appr.'Request Data'.Name,
                    
                                                                appr.'Dynamic Approver Type' =
                                                                'Business Approval Dynamic Approver Type'.'Use Request Data Field',
                                                                appr.'Request Data'.Name,
                    
                                                                appr.Name
                                                            ),
                                                        'Approver Id': appr.'Approver Id', 'Approver Type': appr.'Approver Type',
                                                        'Dynamic Approver Type': appr.'Dynamic Approver Type', 'Request Data': appr.'Request Data'
                                                    }
                                                )
                                            )
                                        )
                                    )
                                );
                    
                                //refresh selected node reference
                                Refresh('Business Approval Nodes');
                                Set(_selectedNode, LookUp('Business Approval Nodes', 'Business Approval Node' = _selectedNode.'Business Approval Node'))
                            );
                            Set(_isBusy, false);
                    )
                Theme: =AppThemeJson
                Visible: =conNodeBoxPath3.Visible 
                Width: =25
                X: =conNodeBoxPath3.X + conNodeBoxPath3.Width - Self.Width - 5
                Y: =lblNodeNamePath3.Y + lblNodeNamePath3.Height / 2 - Self.Height / 2
                ZIndex: =43

            "commandbarCKEditNode4 As 'Fluent Command Bar (1.0.22)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                Items: |-
                    =Table(
                       {
                            ItemKey: "edit",
                            ItemDisplayName: "Edit Node",
                            ItemIconName: "Edit"
                        },
                        {
                            ItemKey: "delete",
                            ItemDisplayName: "Delete Node",
                            ItemIconName: "Delete"
                        }
                    )
                OnChange: =
                OnSelect: |-
                    =Switch(
                        Self.Selected.ItemKey,
                        "edit",
                       With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 4) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    ),
                        "delete",
                        Set(_showConfirmNode,true);
                        Set(_selectedNode,LookUp(ThisItem.Nodes, 'Path Index' = 4));
                        Set(confirmMessageNodeDelete,"Deleting node - " & _selectedNode.Name & ". This cannot be undone. Are you sure?");
                        //
                            //increment node index for any nodes after this node in this path, if exists
                            UpdateIf('Business Approval Nodes', 
                                'Path Index' = _selectedNode.'Path Index' && 'Row Index' >= _selectedNode.'Row Index' &&
                                ThisRecord.'Business Approval Node' <> _selectedNode.'Business Approval Node' &&
                                Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage', 
                                { 'Row Index': ThisRecord.'Row Index' + 1 }
                            );
                    
                            If(CountRows(_nodeApprovers) > 0 || CountRows(_removedApprovers) > 0,
                                Concurrent(
                                    //unrelate removed approvers
                                    Trace("_removedApprovers count: " & CountRows(_removedApprovers), TraceSeverity.Information);
                                    ForAll(_removedApprovers As appr,
                                        Unrelate(_selectedNode.'Business Approvers', LookUp('Business Approvers', 'Business Approver' = appr.Value))
                                    );
                                    Clear(_removedApprovers),
                                    
                                    //add newly added approvers to approver table if does not exist, otherwise update and then relate to selected node
                                    With({ addedApprovers: Filter(_nodeApprovers, IsBlank('Business Approver'))},
                                        Trace("newly added approvers count: " & CountRows(addedApprovers), TraceSeverity.Information);
                                        ForAll(addedApprovers As appr, 
                                            Relate(_selectedNode.'Business Approvers',
                                                Patch('Business Approvers', 
                                                    Coalesce(LookUp('Business Approvers', 'Approver Id' = appr.'Approver Id'), Defaults('Business Approvers')),
                                                    { 
                                                        Name: 
                                                            If(
                                                                appr.'Dynamic Approver Type' = 
                                                                'Business Approval Dynamic Approver Type'.'Manager of [Request data field]', 
                                                                "Manager of " & appr.'Request Data'.Name,
                    
                                                                appr.'Dynamic Approver Type' =
                                                                'Business Approval Dynamic Approver Type'.'Use Request Data Field',
                                                                appr.'Request Data'.Name,
                    
                                                                appr.Name
                                                            ),
                                                        'Approver Id': appr.'Approver Id', 'Approver Type': appr.'Approver Type',
                                                        'Dynamic Approver Type': appr.'Dynamic Approver Type', 'Request Data': appr.'Request Data'
                                                    }
                                                )
                                            )
                                        )
                                    )
                                );
                    
                                //refresh selected node reference
                                Refresh('Business Approval Nodes');
                                Set(_selectedNode, LookUp('Business Approval Nodes', 'Business Approval Node' = _selectedNode.'Business Approval Node'))
                            );
                            Set(_isBusy, false);
                    )
                Theme: =AppThemeJson
                Visible: =conNodeBoxPath4.Visible 
                Width: =25
                X: =conNodeBoxPath4.X + conNodeBoxPath4.Width - Self.Width - 5
                Y: =lblNodeNamePath4.Y + lblNodeNamePath4.Height / 2 - Self.Height / 2
                ZIndex: =44

            "commandbarCKEditNode5 As 'Fluent Command Bar (1.0.22)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                Items: |-
                    =Table(
                       {
                            ItemKey: "edit",
                            ItemDisplayName: "Edit Node",
                            ItemIconName: "Edit"
                        },
                        {
                            ItemKey: "delete",
                            ItemDisplayName: "Delete Node",
                            ItemIconName: "Delete"
                        }
                    )
                OnChange: =
                OnSelect: |-
                    =Switch(
                        Self.Selected.ItemKey,
                        "edit",
                        With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 5) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    ),
                        "delete",
                        Set(_showConfirmNode,true);
                         Set(_selectedNode,LookUp(ThisItem.Nodes, 'Path Index' = 5));
                        Set(confirmMessageNodeDelete,"Deleting node - " & _selectedNode.Name & ". This cannot be undone. Are you sure?");
                        //
                            //increment node index for any nodes after this node in this path, if exists
                            UpdateIf('Business Approval Nodes', 
                                'Path Index' = _selectedNode.'Path Index' && 'Row Index' >= _selectedNode.'Row Index' &&
                                ThisRecord.'Business Approval Node' <> _selectedNode.'Business Approval Node' &&
                                Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage', 
                                { 'Row Index': ThisRecord.'Row Index' + 1 }
                            );
                    
                            If(CountRows(_nodeApprovers) > 0 || CountRows(_removedApprovers) > 0,
                                Concurrent(
                                    //unrelate removed approvers
                                    Trace("_removedApprovers count: " & CountRows(_removedApprovers), TraceSeverity.Information);
                                    ForAll(_removedApprovers As appr,
                                        Unrelate(_selectedNode.'Business Approvers', LookUp('Business Approvers', 'Business Approver' = appr.Value))
                                    );
                                    Clear(_removedApprovers),
                                    
                                    //add newly added approvers to approver table if does not exist, otherwise update and then relate to selected node
                                    With({ addedApprovers: Filter(_nodeApprovers, IsBlank('Business Approver'))},
                                        Trace("newly added approvers count: " & CountRows(addedApprovers), TraceSeverity.Information);
                                        ForAll(addedApprovers As appr, 
                                            Relate(_selectedNode.'Business Approvers',
                                                Patch('Business Approvers', 
                                                    Coalesce(LookUp('Business Approvers', 'Approver Id' = appr.'Approver Id'), Defaults('Business Approvers')),
                                                    { 
                                                        Name: 
                                                            If(
                                                                appr.'Dynamic Approver Type' = 
                                                                'Business Approval Dynamic Approver Type'.'Manager of [Request data field]', 
                                                                "Manager of " & appr.'Request Data'.Name,
                    
                                                                appr.'Dynamic Approver Type' =
                                                                'Business Approval Dynamic Approver Type'.'Use Request Data Field',
                                                                appr.'Request Data'.Name,
                    
                                                                appr.Name
                                                            ),
                                                        'Approver Id': appr.'Approver Id', 'Approver Type': appr.'Approver Type',
                                                        'Dynamic Approver Type': appr.'Dynamic Approver Type', 'Request Data': appr.'Request Data'
                                                    }
                                                )
                                            )
                                        )
                                    )
                                );
                    
                                //refresh selected node reference
                                Refresh('Business Approval Nodes');
                                Set(_selectedNode, LookUp('Business Approval Nodes', 'Business Approval Node' = _selectedNode.'Business Approval Node'))
                            );
                            Set(_isBusy, false);
                    )
                Theme: =AppThemeJson
                Visible: =conNodeBoxPath5.Visible 
                Width: =25
                X: =conNodeBoxPath5.X + conNodeBoxPath5.Width - Self.Width - 5
                Y: =lblNodeNamePath5.Y + lblNodeNamePath5.Height / 2 - Self.Height / 2
                ZIndex: =45

            "commandbarCKEditNode1 As 'Fluent Command Bar (1.0.22)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                Items: |-
                    =Table(
                       {
                            ItemKey: "edit",
                            ItemDisplayName: "Edit Node",
                            ItemIconName: "Edit"
                        },
                        {
                            ItemKey: "delete",
                            ItemDisplayName: "Delete Node",
                            ItemIconName: "Delete"
                        }
                    )
                OnChange: =
                OnSelect: |-
                    =Switch(
                        Self.Selected.ItemKey,
                        "edit",
                        With({ node: LookUp(ThisItem.Nodes, 'Path Index' = 1) },
                        ApprovalDesigner.EditNode(node.'Business Approval Node', node.Stage.'Business Approval Stage')
                    ),
                        "delete",
                        Set(_showConfirmNode,true);
                        Set(_selectedNode,LookUp(ThisItem.Nodes, 'Path Index' = 1));
                        Set(confirmMessageNodeDelete,"Deleting node - " & _selectedNode.Name & ". This cannot be undone. Are you sure?");
                        //
                            //increment node index for any nodes after this node in this path, if exists
                            UpdateIf('Business Approval Nodes', 
                                'Path Index' = _selectedNode.'Path Index' && 'Row Index' >= _selectedNode.'Row Index' &&
                                ThisRecord.'Business Approval Node' <> _selectedNode.'Business Approval Node' &&
                                Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage', 
                                { 'Row Index': ThisRecord.'Row Index' + 1 }
                            );
                    
                            If(CountRows(_nodeApprovers) > 0 || CountRows(_removedApprovers) > 0,
                                Concurrent(
                                    //unrelate removed approvers
                                    Trace("_removedApprovers count: " & CountRows(_removedApprovers), TraceSeverity.Information);
                                    ForAll(_removedApprovers As appr,
                                        Unrelate(_selectedNode.'Business Approvers', LookUp('Business Approvers', 'Business Approver' = appr.Value))
                                    );
                                    Clear(_removedApprovers),
                                    
                                    //add newly added approvers to approver table if does not exist, otherwise update and then relate to selected node
                                    With({ addedApprovers: Filter(_nodeApprovers, IsBlank('Business Approver'))},
                                        Trace("newly added approvers count: " & CountRows(addedApprovers), TraceSeverity.Information);
                                        ForAll(addedApprovers As appr, 
                                            Relate(_selectedNode.'Business Approvers',
                                                Patch('Business Approvers', 
                                                    Coalesce(LookUp('Business Approvers', 'Approver Id' = appr.'Approver Id'), Defaults('Business Approvers')),
                                                    { 
                                                        Name: 
                                                            If(
                                                                appr.'Dynamic Approver Type' = 
                                                                'Business Approval Dynamic Approver Type'.'Manager of [Request data field]', 
                                                                "Manager of " & appr.'Request Data'.Name,
                    
                                                                appr.'Dynamic Approver Type' =
                                                                'Business Approval Dynamic Approver Type'.'Use Request Data Field',
                                                                appr.'Request Data'.Name,
                    
                                                                appr.Name
                                                            ),
                                                        'Approver Id': appr.'Approver Id', 'Approver Type': appr.'Approver Type',
                                                        'Dynamic Approver Type': appr.'Dynamic Approver Type', 'Request Data': appr.'Request Data'
                                                    }
                                                )
                                            )
                                        )
                                    )
                                );
                    
                                //refresh selected node reference
                                Refresh('Business Approval Nodes');
                                Set(_selectedNode, LookUp('Business Approval Nodes', 'Business Approval Node' = _selectedNode.'Business Approval Node'))
                            );
                            Set(_isBusy, false);
                    )
                Theme: =AppThemeJson
                Visible: =conNodeBoxPath1.Visible 
                Width: =25
                X: =nodeBoxPath1.X + nodeBoxPath1.Width - Self.Width - 5
                Y: =lblNodeNamePath1.Y + lblNodeNamePath1.Height / 2 - Self.Height / 2
                ZIndex: =46

        galStageConditions_1 As gallery.galleryVertical:
            AccessibleLabel: ="Conditions"
            BorderColor: =RGBA(166, 166, 166, 1)
            Height: =If(Self.Visible, 62, 0)
            Items: |-
                =AddColumns(
                    SortByColumns(
                        ThisItem.'Business Approval Conditions (cat_BusinessApprovalCondition_Stage_cat_B)',
                        //Filter('Business Approval Conditions', Stage.'Business Approval Stage' = ThisItem.'Business Approval Stage'), 
                        "cat_pathindex"
                    ),
                   "StageSelection", ThisItem
                )
            Layout: =Layout.Vertical
            OnSelect: =
            ShowScrollbar: =false
            TemplatePadding: =0
            TemplateSize: =Self.Height
            Visible: =CountRows(Self.AllItems) > 0 && icoToggleStage_1.Icon = Icon.ChevronUp && ThisItem.'Stage Condition' <> 'Business Approval Stage Condition'.None
            Width: =Parent.TemplateWidth
            WrapCount: =Max(2, CountRows(Self.AllItems))
            Y: =lblStageConditionText_1.Y + lblStageConditionText_1.Height
            ZIndex: =9

            nodeLineRightH_3 As rectangle:
                BorderColor: =RGBA(105, 121, 126, 1)
                DisplayMode: =DisplayMode.Disabled
                Fill: =ColorValue(AppTheme.palette.themePrimary)//RGBA(128, 128, 128, 1)
                FocusedBorderThickness: =4
                Height: =1
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =Select(Parent)
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =ThisItem.'Path Index' < ThisItem.StageSelection.Paths
                Width: =Parent.TemplateWidth / 2
                X: =nodeLineCondition_6.X
                ZIndex: =1

            nodeLineLeftH_6 As rectangle:
                BorderColor: =RGBA(105, 121, 126, 1)
                DisplayMode: =DisplayMode.Disabled
                Fill: =ColorValue(AppTheme.palette.themePrimary) //RGBA(128, 128, 128, 1)
                FocusedBorderThickness: =4
                Height: =1
                HoverFill: =ColorValue(AppTheme.palette.themePrimary) //RGBA(105, 121, 126, 1)
                OnSelect: =Select(Parent)
                PressedFill: =RGBA(105, 121, 126, 1)
                Visible: =ThisItem.'Path Index' > 1
                Width: =Parent.TemplateWidth / 2
                ZIndex: =7

            nodeLineCondition_6 As rectangle:
                BorderColor: =RGBA(0, 0, 0, 1)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                DisplayMode: =DisplayMode.Disabled
                Fill: =ColorValue(AppTheme.palette.themePrimary)//RGBA(128, 128, 128, 1)
                FocusedBorderThickness: =4
                Height: =10
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Width: =1
                X: =btnAddFirstNodeInCondition_1.X + btnAddFirstNodeInCondition_1.Width / 2 - Self.Width / 2
                ZIndex: =8

            lblConditionTarget_5 As label:
                Align: =Align.Center
                AutoHeight: =true
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(51, 51, 51, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Fill: =ColorValue(AppTheme.palette.themeLight) //RGBA(237, 237, 237, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =28
                PaddingTop: =0
                Size: =8
                Text: |-
                    =If(ThisItem.StageSelection.'Stage Condition' = 'Business Approval Stage Condition'.'If/Else', "TRUE",
                        If(ThisItem.'Condition Data Type' = 'Business Approval Condition Target Data'.'Request Data',
                            ThisItem.'Condition Data'.Name, 
                            ThisItem.'Condition Value Display'
                        )
                    )
                Tooltip: =Self.Text
                Visible: =false
                Width: =nodeLineRightH_3.Width
                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                Y: =10
                ZIndex: =9

            btnAddFirstNodeInCondition_1 As button:
                BorderColor: =RGBA(74, 85, 88, 1)
                BorderThickness: =1
                Color: =RGBA(74, 85, 88, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(204, 204, 204, 1)
                FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =20
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(105, 121, 126, 1), -10%)
                OnSelect: =ApprovalDesigner.AddNode(ThisItem.'Path Index', 1, ThisItem.Stage.Order, ThisItem.Stage.'Business Approval Stage')
                PaddingBottom: =3
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                RadiusBottomLeft: =20
                RadiusBottomRight: =20
                RadiusTopLeft: =20
                RadiusTopRight: =20
                Size: =12
                Text: ="+"
                Visible: =false
                Width: =20
                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                Y: =conConditionLabel.Y + conConditionLabel.Height
                ZIndex: =10

            conConditionLabel As groupContainer.manualLayoutContainer:
                DropShadow: =DropShadow.Light
                Fill: =ColorValue(AppTheme.palette.themeLight)
                Height: =28
                RadiusBottomLeft: =8
                RadiusBottomRight: =8
                RadiusTopLeft: =8
                RadiusTopRight: =8
                Width: =If(ThisItem.StageSelection.'Stage Condition' = 'Business Approval Stage Condition'.'If/Else',"60",nodeLineRightH_3.Width)
                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                Y: =10
                ZIndex: =12

                lblConditionTarget_7 As label:
                    Align: =Align.Center
                    AutoHeight: =true
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    Color: =RGBA(51, 51, 51, 1)
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    Fill: =ColorValue(AppTheme.palette.themeLight) //RGBA(237, 237, 237, 1)
                    FocusedBorderThickness: =4
                    Font: =Font.'Segoe UI'
                    FontWeight: =FontWeight.Semibold
                    Height: =28
                    PaddingTop: =0
                    Size: =8
                    Text: |-
                        =If(ThisItem.StageSelection.'Stage Condition' = 'Business Approval Stage Condition'.'If/Else', "TRUE",
                            If(ThisItem.'Condition Data Type' = 'Business Approval Condition Target Data'.'Request Data',
                                ThisItem.'Condition Data'.Name, 
                                ThisItem.'Condition Value Display'
                            )
                        )
                    Tooltip: =Self.Text
                    Width: =Parent.Width
                    X: =
                    Y: =10
                    ZIndex: =1

            "icoCKFirstTrueNode As 'Fluent Icon (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                HoverFillColor: =AppTheme.palette.themeLighter
                IconName: ="CircleAdditionSolid"
                IconSize: =22
                OnChange: =ApprovalDesigner.AddNode(ThisItem.'Path Index', 1, ThisItem.Stage.Order, ThisItem.Stage.'Business Approval Stage')
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Theme: =AppThemeJson
                Tooltip: |-
                    =If(
                        ThisItem.StageSelection.'Stage Condition' = 'Business Approval Stage Condition'.'If/Else',
                        "Create node under " & ThisItem.'Stage Name Value' &" for true condition",
                        "Create node under " & ThisItem.'Stage Name Value' &" for "& ThisItem.'Condition Value Display'
                    )
                Width: =25
                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                Y: =conConditionLabel.Y + conConditionLabel.Height
                ZIndex: =13

        conFalsePath_1 As groupContainer:
            BorderColor: =RGBA(105, 121, 126, 1)
            Height: =galStageConditions_1.Height
            Visible: =ThisItem.'Stage Condition' = 'Business Approval Stage Condition'.'If/Else' && icoToggleStage_1.Icon = Icon.ChevronUp
            Width: =galStageConditions_1.TemplateWidth
            X: =galStageConditions_1.X + galStageConditions_1.Width / 2
            Y: =galStageConditions_1.Y
            ZIndex: =10

            nodeLineLeftH_7 As rectangle:
                BorderColor: =ColorValue(AppTheme.palette.themePrimary)//RGBA(105, 121, 126, 1)
                DisplayMode: =DisplayMode.Disabled
                Fill: =ColorValue(AppTheme.palette.themePrimary)//RGBA(128, 128, 128, 1)
                FocusedBorderThickness: =4
                Height: =1
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Width: =Parent.Width / 2
                ZIndex: =3

            nodeLineCondition_7 As rectangle:
                BorderColor: =RGBA(0, 0, 0, 1)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                DisplayMode: =DisplayMode.Disabled
                Fill: =ColorValue(AppTheme.palette.themePrimary)//RGBA(128, 128, 128, 1)
                FocusedBorderThickness: =4
                Height: =10
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =
                PressedFill: =RGBA(105, 121, 126, 1)
                Width: =1
                X: =nodeLineLeftH_7.X + nodeLineLeftH_7.Width 
                ZIndex: =4

            btnAddFirstNodeFalsePath_2 As button:
                BorderColor: =ColorValue(AppTheme.palette.themePrimary) 
                BorderThickness: =1
                Color: =ColorValue(AppTheme.palette.white) 
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =ColorValue(AppTheme.palette.themePrimary) 
                FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =20
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =ColorValue(AppTheme.palette.white) 
                HoverFill: =ColorFade(ColorValue(AppTheme.palette.themePrimary), -10%)
                OnSelect: =ApprovalDesigner.AddNode(2, 1, ThisItem.Order, ThisItem.'Business Approval Stage')
                PaddingBottom: =3
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                RadiusBottomLeft: =20
                RadiusBottomRight: =20
                RadiusTopLeft: =20
                RadiusTopRight: =20
                Size: =12
                Text: ="+"
                Visible: =false
                Width: =20
                X: =Parent.Width / 2 - Self.Width / 2
                Y: =conConditionLabelFalse.Y + conConditionLabelFalse.Height
                ZIndex: =6

            conConditionLabelFalse As groupContainer.manualLayoutContainer:
                DropShadow: =DropShadow.Light
                Fill: =ColorValue(AppTheme.palette.themeLight)
                Height: =28
                RadiusBottomLeft: =8
                RadiusBottomRight: =8
                RadiusTopLeft: =8
                RadiusTopRight: =8
                Width: =60
                X: =nodeLineLeftH_7.X + nodeLineLeftH_7.Width - Self.Width/2
                Y: =10
                ZIndex: =7

                lablConditionFalse As label:
                    Align: =Align.Center
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    Color: =RGBA(51, 51, 51, 1)
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    FocusedBorderThickness: =4
                    Font: =Font.'Segoe UI'
                    Height: =28
                    PaddingTop: =0
                    Size: =9
                    Text: ="FALSE"
                    Tooltip: =Self.Text
                    Width: =Parent.Width
                    Y: =5
                    ZIndex: =1

            "icoCKFirstFalseNode As 'Fluent Icon (1.0.22)'":
                DisplayMode: =DisplayMode.Edit
                Height: =25
                HoverFillColor: =AppTheme.palette.themeLighter
                IconName: ="CircleAdditionSolid"
                IconSize: =22
                OnChange: =ApprovalDesigner.AddNode(2, 1, ThisItem.Order, ThisItem.'Business Approval Stage')
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Theme: =AppThemeJson
                Tooltip: ="Create node under " & ThisItem.Name & " for false condition"
                Width: =25
                X: =Parent.Width / 2 - Self.Width / 2
                Y: =conConditionLabelFalse.Y + conConditionLabelFalse.Height + 3
                ZIndex: =8

        "icoEdit_1 As 'Fluent Icon (1.0.22)'":
            DisplayMode: =DisplayMode.Edit
            FillColor: =
            FontColor: =
            Height: =30
            HoverFillColor: =AppTheme.palette.themeLighter
            HoverFontColor: =""
            IconColor: =AppTheme.palette.themePrimary
            IconName: ="Edit"
            OnChange: =ApprovalDesigner.EditStage(ThisItem.'Business Approval Stage')
            TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
            Theme: =AppThemeJson
            Tooltip: ="Edit stage"
            Visible: =false
            Width: =30
            X: =Parent.TemplateWidth - 62
            Y: =stageBackground_1.Y + 1
            ZIndex: =11

        "icoToggle_1 As 'Fluent Icon (1.0.22)'":
            AccessibilityLabel: =If(ThisItem.'Business Approval Stage' in _collapsedStage.Value, "Hide stage", "Expand stage")
            DisplayMode: =DisplayMode.Edit
            Height: =30
            HoverFillColor: =AppTheme.palette.themeLighter
            IconName: =If(ThisItem.'Business Approval Stage' in _collapsedStage.Value, "ChevronDown", "ChevronUp")
            OnChange: |
                =If(icoToggleStage_1.Icon = Icon.ChevronUp, 
                    Collect(_collapsedStage, ThisItem.'Business Approval Stage'), 
                    RemoveIf(_collapsedStage, Value = ThisItem.'Business Approval Stage')
                )
                /*
                If(ThisItem.'Business Approval Stage' in _collapsedStage.Value, 
                    Collect(_collapsedStage, ThisItem.'Business Approval Stage'), 
                    RemoveIf(_collapsedStage, Value = ThisItem.'Business Approval Stage')
                )*/
            TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
            Theme: =AppThemeJson
            Tooltip: =If(ThisItem.'Business Approval Stage' in _collapsedStage.Value, "Hide stage", "Expand stage")
            Visible: =false
            Width: =30
            X: =Parent.TemplateWidth - Self.Width - 2
            Y: =stageBackground_1.Y + 1
            ZIndex: =12

        "icoShiftDown_1 As 'Fluent Icon (1.0.22)'":
            DisplayMode: =DisplayMode.Edit
            Height: =30
            HoverFillColor: =AppTheme.palette.themeLighter
            IconName: ="Down"
            OnChange: =ApprovalDesigner.MoveStage(ThisItem.'Business Approval Stage', false)
            TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
            Theme: =AppThemeJson
            Tooltip: ="Move stage down"
            Visible: =false
            Width: =30
            X: =icoEdit_1.X - Self.Width - 2
            Y: =stageBackground_1.Y + 1
            ZIndex: =13

        "icoShiftUp_1 As 'Fluent Icon (1.0.22)'":
            DisplayMode: =DisplayMode.Edit
            Height: =30
            HoverFillColor: =AppTheme.palette.themeLighter
            IconName: ="Up"
            OnChange: =ApprovalDesigner.MoveStage(ThisItem.'Business Approval Stage', true)
            TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
            Theme: =AppThemeJson
            Tooltip: ="Move stage up"
            Visible: =false
            Width: =30
            X: =icoMoveDown.X - Self.Width - 2
            Y: =stageBackground_1.Y + 1
            ZIndex: =14

        btnAddFirstNode_1 As button:
            BorderColor: =RGBA(74, 85, 88, 1)
            BorderThickness: =1
            Color: =RGBA(74, 85, 88, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            Fill: =RGBA(204, 204, 204, 1)
            FocusedBorderColor: =ColorFade(Self.Fill, -75%)
            Font: =Font.'Segoe UI'
            FontWeight: =FontWeight.Semibold
            Height: =If(Self.Visible, 20, 0)
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =ColorValue(AppTheme.palette.white) 
            HoverFill: =ColorFade(ColorValue(AppTheme.palette.themePrimary), -10%)
            OnSelect: |-
                =ApprovalDesigner.AddNode(1, 1, ThisItem.Order, ThisItem.'Business Approval Stage')
                
                /*
                Set(_currentNodeIndex, 1);
                Set(_currentPathIndex, 1);
                Set(_currentStageCount, CountRows(galProcessStages_1.AllItems));
                Set(_selectedStage, ThisItem);
                Set(_selectedNode, Blank());
                Navigate(scrApprovalNodeEditor)*/
            PaddingBottom: =3
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
            PressedColor: =ColorValue(AppTheme.palette.white) 
            PressedFill: =ColorFade(ColorValue(AppTheme.palette.themePrimary) , -30%)
            RadiusBottomLeft: =20
            RadiusBottomRight: =20
            RadiusTopLeft: =20
            RadiusTopRight: =20
            Size: =12
            Text: ="+"
            Visible: =!galStageNodes.Visible && ThisItem.'Stage Condition' = 'Business Approval Stage Condition'.None && icoToggleStage_1.Icon = Icon.ChevronUp
            Width: =20
            X: =Parent.TemplateWidth / 2 - Self.Width / 2
            Y: =lblGalStageName_1.Height
            ZIndex: =15

        lblNoNodeInStage_1 As label:
            Align: =Align.Center
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =If(Self.Visible, 30, 0)
            OnSelect: =Select(Parent)
            Size: =9
            Text: ="No node configured for this stage. Click '+' to add first node."
            Visible: =btnAddFirstNode_1.Visible
            Width: =Parent.TemplateWidth
            X: =btnAddFirstNode_1.X + btnAddFirstNode_1.Width / 2 - Self.Width / 2
            Y: =btnAddFirstNode_1.Y + btnAddFirstNode_1.Height + 5
            ZIndex: =16

        lblStageConditionText_1 As label:
            Align: =Align.Center
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =If(Self.Visible, 20, 0)
            OnSelect: =Select(Parent)
            Size: =8
            Text: |-
                ="If " & If(ThisItem.'Source Data Type' = 'Business Approval Condition Source Data'.'Request Data', 
                    ThisItem.'Source Data Name Value', ThisItem.'Source Data Type') & " " & ThisItem.Operand & 
                If(ThisItem.'Stage Condition' = 'Business Approval Stage Condition'.'If/Else', " " & 
                    First(Filter('Business Approval Conditions', Stage.'Business Approval Stage' = ThisItem.'Business Approval Stage')).'Condition Value Display'
                )
            Visible: =(ThisItem.'Stage Condition' <> 'Business Approval Stage Condition'.None) && icoToggleStage_1.Icon = Icon.ChevronUp
            Width: =Parent.TemplateWidth
            X: =btnAddFirstNode_1.X + btnAddFirstNode_1.Width / 2 - Self.Width / 2
            Y: =btnAddFirstNode_1.Y + btnAddFirstNode_1.Height + If(btnAddFirstNode_1.Visible, 5, 0)
            ZIndex: =17

        lblGalStageName_1 As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            FontWeight: =FontWeight.Semibold
            Height: =30
            OnSelect: =Select(Parent)
            PaddingLeft: =8
            Size: =10
            Text: |-
                ="Stage: " & ThisItem.Name
            Tooltip: =Self.Text
            Width: =icoMoveUp.X
            Wrap: =false
            Y: =stageBackground_1.Y
            ZIndex: =18

        "CommandBarOptions As 'Fluent Command Bar (1.0.22)'.pcfdataset":
            DisplayMode: =DisplayMode.Edit
            Height: =35
            Items: |-
                =Table(
                   {
                        ItemKey: "edit",
                        ItemDisplayName: "Edit",
                        ItemIconName: "Edit"
                    },
                    {
                        ItemKey: "delete",
                        ItemDisplayName: "Delete",
                        ItemIconName: "Delete"
                    },{
                        ItemKey: "up",
                        ItemDisplayName: "Move Up",
                        ItemIconName: "Up"
                    },{
                        ItemKey: "down",
                        ItemDisplayName: "Move Down",
                        ItemIconName: "Down"
                    }
                )
            OnChange: =
            OnSelect: |-
                =Switch(
                    Self.Selected.ItemKey,
                    "edit",
                    ApprovalDesigner.EditStage(ThisItem.'Business Approval Stage'),
                    "delete",
                    Set(confirmActionDelete,"delete");Set(_selectedStage, ThisItem);Set(confirmMessageDeteleStage, "Deleting Stage - " & _selectedStage.Name & ". This will also delete all approval nodes in this stage and it cannot be undone. Are you sure?");Set(_showConfirmDeleteStage, true),
                    "up",
                    ApprovalDesigner.MoveStage(
                        ThisItem.'Business Approval Stage',
                        true
                    ),
                    "down",
                    ApprovalDesigner.MoveStage(
                        ThisItem.'Business Approval Stage',
                        false
                    )
                )
            Theme: =AppThemeJson
            Width: =35
            X: =Parent.TemplateWidth - Self.Width - 2
            Y: =stageBackground_1.Y + 1
            ZIndex: =19

    "icoAddStage_1 As 'Fluent Icon (1.0.22)'":
        DisplayMode: =DisplayMode.Edit
        FontSize: =30
        Height: =45
        IconName: ="CircleAdditionSolid"
        IconSize: =35
        OnChange: =ApprovalDesigner.AddStage()
        TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
        Theme: =AppThemeJson
        Tooltip: ="Add Stage"
        Visible: =true
        Width: =30
        X: =Parent.Width / 2 - Self.Width / 2
        Y: =galProcessStages_1.Height + 10
        ZIndex: =3

