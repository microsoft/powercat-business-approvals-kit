scrStageEditor As screen:
    LoadingSpinnerColor: =RGBA(105, 121, 126, 1)
    OnHidden: |
        =Clear(_conditions); Clear(_removedConditions);
        Reset(ddlStageCondition); Reset(radSwitchPaths);
        Reset(ddlStageConditionSource); Reset(ddlStageOperand);
    OnVisible: |-
        =//cache operands if not already available
        If(IsEmpty(_operands),
            ClearCollect(_operands, 
                { 
                    operands: [
                        'Business Approval Condition Operand'.'Equals (=)', 'Business Approval Condition Operand'.'Not Equal (<>)',
                        'Business Approval Condition Operand'.'Starts With', 'Business Approval Condition Operand'.'Ends With',
                        'Business Approval Condition Operand'.Contains, 'Business Approval Condition Operand'.'Is Blank',
                        'Business Approval Condition Operand'.'Is Not Blank'
                    ],
                    type: [ 'Business Approval Data Type'.Text, 'Business Approval Data Type'.'User (Email)' ]
                },
                { 
                    operands: [
                        'Business Approval Condition Operand'.'Equals (=)', 'Business Approval Condition Operand'.'Less Than (<)',
                        'Business Approval Condition Operand'.'Less Than or Equals (<=)', 'Business Approval Condition Operand'.'Greater Than (>)',
                        'Business Approval Condition Operand'.'Greater Than or Equals (>=)', 'Business Approval Condition Operand'.'Not Equal (<>)',
                        'Business Approval Condition Operand'.'Is Blank', 'Business Approval Condition Operand'.'Is Not Blank'
                    ],
                    type: [ 'Business Approval Data Type'.Number, 'Business Approval Data Type'.'Date/Time' ]
                },
                { 
                    operands: [
                        'Business Approval Condition Operand'.'Equals (=)', 'Business Approval Condition Operand'.'Not Equal (<>)',
                        'Business Approval Condition Operand'.'Is Blank', 'Business Approval Condition Operand'.'Is Not Blank'
                    ],
                    type: [ 'Business Approval Data Type'.Boolean ]
                }
            )
        );
        
        //load conditions if exists
        ForAll(
            Filter(
                Filter('Business Approval Conditions','Business Approval Conditions (Views)'.'Active Stage Conditions'),
                Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage'
            ),
            Collect(_conditions, 
            { 
                ConditionId: ThisRecord.'Business Approval Condition', Path: ThisRecord.'Path Index', 
                Target: ThisRecord.'Condition Data Type', TargetData: ThisRecord.'Condition Data', 
                StaticValue: ThisRecord.'Condition Value', 
                IsDefault: ThisRecord.'Is Default' = 'Is Default (Business Approval Conditions)'.Yes,
                IsParallel: ThisRecord.'Is Parallel' = 'Is Parallel (Business Approval Conditions)'.Yes
            })
        );
        
        //allow change of condition type if there are no existing conditions defined
        //isCleared - tracks if the user clicked on "Clear" (may not yet proceed to change condition, as they can undo it)
        UpdateContext({ allowUpdateConditionType: CountRows(_conditions) = 0, isCleared: false });
        
        SetFocus(txtStageName)

    Container1_4 As groupContainer:
        Height: =Parent.Height - Self.Y
        Width: =Parent.Width - Self.X
        X: =Menu_5.Width
        Y: =Menu_5.Y
        ZIndex: =1

        bcProcessStage As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            FontWeight: =Semibold
            Height: =30
            PaddingLeft: =0
            Size: =10
            Text: =_selectedProcess.Name & " > " & Coalesce(_selectedStage.Name, "(New Stage)")
            Width: =Parent.Width - Self.X - 20
            Wrap: =false
            X: =20
            Y: =Toolbar_4.Y + Toolbar_4.Height
            ZIndex: =1

        lblStageName As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="Name"
            Width: =120
            X: =bcProcessStage.X
            Y: =bcProcessStage.Y + bcProcessStage.Height + 10
            ZIndex: =2

        txtStageName As text:
            BorderColor: =RGBA(166, 166, 166, 1)
            Clear: =true
            Color: =RGBA(51, 51, 51, 1)
            Default: =_selectedStage.Name
            DelayOutput: =true
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            FocusedBorderThickness: =1
            Font: =Font.'Segoe UI'
            Height: =30
            HoverBorderColor: =Self.BorderColor
            HoverColor: =RGBA(51, 51, 51, 1)
            HoverFill: =RGBA(255, 255, 255, 1)
            MaxLength: =100
            OnChange: =
            PaddingLeft: =5
            PressedBorderColor: =Self.BorderColor
            PressedColor: =RGBA(51, 51, 51, 1)
            PressedFill: =RGBA(255, 255, 255, 1)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =10
            Width: =(Parent.Width - Self.X) / 2
            X: =140
            Y: =lblStageName.Y
            ZIndex: =3

        lblStageDesc As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="Description"
            Width: =120
            X: =lblStageName.X
            Y: =lblStageName.Y + lblStageName.Height + 10
            ZIndex: =4

        txtStageDesc As text:
            BorderColor: =RGBA(166, 166, 166, 1)
            Clear: =true
            Color: =RGBA(51, 51, 51, 1)
            Default: =_selectedStage.Description
            DelayOutput: =true
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            FocusedBorderThickness: =1
            Font: =Font.'Segoe UI'
            Height: =60
            HoverBorderColor: =Self.BorderColor
            HoverColor: =RGBA(51, 51, 51, 1)
            HoverFill: =RGBA(255, 255, 255, 1)
            MaxLength: =100
            Mode: =TextMode.MultiLine
            OnChange: =
            PaddingLeft: =5
            PressedBorderColor: =Self.BorderColor
            PressedColor: =RGBA(51, 51, 51, 1)
            PressedFill: =RGBA(255, 255, 255, 1)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =10
            Width: =(Parent.Width - Self.X) / 2
            X: =txtStageName.X
            Y: =lblStageDesc.Y
            ZIndex: =5

        lblStageConditionHeader As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            FontWeight: =Semibold
            Height: =30
            PaddingLeft: =0
            Size: =10
            Text: ="Conditions"
            Width: =txtStageName.X - Self.X
            Wrap: =false
            X: =bcProcessStage.X
            Y: =txtStageDesc.Y + txtStageDesc.Height + 20
            ZIndex: =6

        lblStageCondition As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="Condition"
            Width: =120
            X: =lblStageName.X
            Y: =244
            ZIndex: =7

        ddlStageCondition As dropdown:
            BorderColor: =RGBA(166, 166, 166, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(255, 255, 255, 1)
            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
            ChevronFill: =RGBA(33, 33, 33, 1)
            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
            ChevronHoverFill: =RGBA(33, 33, 33, 1)
            Color: =RGBA(51, 51, 51, 1)
            Default: =_selectedStage.'Stage Condition'
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            DisplayMode: =If(_currentStageIndex < 2 || !allowUpdateConditionType, Disabled, DisplayMode.Edit)
            FocusedBorderThickness: =1
            Font: =Font.'Segoe UI'
            Height: =30
            HoverBorderColor: =Self.BorderColor
            HoverFill: =RGBA(243, 242, 241, 1)
            Items: =Choices('Business Approval Stage Condition')
            OnChange: |-
                =UpdateContext({ conditionsCount: CountRows(_conditions)});
                Switch(Self.Selected.Value,
                
                    //--- Case = If/Else ---
                    'Business Approval Stage Condition'.'If/Else', 
                    //if there are existing conditions, remove all except the first condition
                    Collect(_removedConditions, 
                        ShowColumns(Filter(_conditions, Path > 1), "ConditionId", "Path", "Target", "TargetData", "StaticValue", "TargetStage")
                    );
                    RemoveIf(_conditions, Path > 1);
                    If(conditionsCount = 0, 
                        ClearCollect(_conditions,
                        { 
                            ConditionId: "", Path: 1, Target: 'Business Approval Condition Target Data'.'Static value', 
                            TargetData: Blank(), StaticValue: "", TargetStage: Blank(), IsDefault: false, IsParallel: false 
                        })
                    );
                    Reset(radSwitchPaths),
                    
                    //--- Case = Switch ---
                    'Business Approval Stage Condition'.Switch, 
                    Collect(_conditions, 
                        ForAll(Sequence(radSwitchPaths.Selected.Value - conditionsCount, conditionsCount + 1), 
                        { 
                            ConditionId: "", Path: Value, Target: 'Business Approval Condition Target Data'.'Static value',
                            TargetData: Blank(), StaticValue: "", TargetStage: Blank(), IsDefault: false, IsParallel: false
                        })
                    );
                    //set last condition as default for switch types
                    Patch(_conditions, Last(_conditions), { IsDefault: true, StaticValue: "Default (Other values)"}),
                
                    //--- Case = None ---
                    'Business Approval Stage Condition'.None, 
                    //if there are any existing conditions, add them to the remove list
                    If(conditionsCount > 0, 
                        Collect(_removedConditions, ShowColumns(_conditions,  "ConditionId", "Path", "Target", "TargetData", "StaticValue", "TargetStage"));    
                        Clear(_conditions)
                    )
                );
                Reset(ddlStageOperand)
            PaddingBottom: =5
            PaddingLeft: =5
            PaddingRight: =5
            PaddingTop: =5
            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
            PressedFill: =Self.HoverFill
            SelectionColor: =Self.Color
            SelectionFill: =RGBA(243, 242, 241, 1)
            Size: =10
            Width: =txtStageDesc.Width - If(btnResetConditions.Visible, btnResetConditions.Width + 20, 0)
            X: =txtStageName.X
            Y: =244
            ZIndex: =8

        imgWorkflowDiagram As image:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledFill: =RGBA(0, 0, 0, 0)
            FocusedBorderThickness: =4
            Height: =If(Self.Visible, 70, 0)
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverFill: =RGBA(0, 0, 0, 0)
            Image: |
                ="data:image/svg+xml;utf8, " & 
                Switch(radSwitchPaths.Selected.Value,
                    3, EncodeUrl("<svg width='657' height='382' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='1718' y='254' width='657' height='382'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-1718 -254)'><path d='M1911.5 324 2048.5 257.5 2185.5 324 2048.5 390.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='1720.5' y='516.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1950.5' y='514.5' width='192' height='118' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M2048.52 390 2048.52 452.736 1816 452.736 1816 515.471' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M2048.01 390 2048.01 451.787 2046 451.787 2046 513.575' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='2181.5' y='514.5' width='191' height='118' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 61.7874 0 61.7874 228.498 123.575 228.498' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2048 390)'/></g></svg>"),
                    4, EncodeUrl("<svg width='907' height='384' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='551' y='760' width='907' height='384'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-551 -760)'><path d='M870.5 830 1007.5 763.5 1144.5 830 1007.5 896.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='553.5' y='1024.5' width='192' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='790.5' y='1024.5' width='192' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M1006.71 896 1006.71 959.73 649 959.73 649 1023.46' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M1006.89 896 1006.89 959.729 886 959.729 886 1023.46' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='1027.5' y='1024.5' width='192' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1264.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 63.7293 0 63.7293 352.731 127.459 352.731' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 1007 896)'/><path d='M0 0 63.7293 0 63.7293 115.918 127.459 115.918' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 1007 896)'/></g></svg>"),
                    5, EncodeUrl("<svg width='1144' height='374' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='1589' y='770' width='1144' height='374'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-1589 -770)'><path d='M2024.5 840 2161 773.5 2297.5 840 2161 906.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='1591.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1828.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M2160.14 906 2160.14 964.793 1686 964.793 1686 1023.59' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M2160.07 906 2160.07 964.793 1923 964.793 1923 1023.59' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='2065.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='2302.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 58.7933 0 58.7933 237.069 117.587 237.069' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2161 906)'/><path d='M0 0 58.7933 0 58.7933 0.000360892 117.586 0.000360892' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2161 906)'/><rect x='2539.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 58.7934 0 58.7934 474.138 117.587 474.138' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2161 906)'/></g></svg>"),
                    EncodeUrl("<svg width='522' height='386' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='752' y='250' width='522' height='386'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-752 -250)'><path d='M870.5 320.5 1007.5 253.5 1144.5 320.5 1007.5 387.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='754.5' y='516.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1080.5' y='516.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M1007.36 387 1007.36 451.678 850 451.678 850 516.356' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M0 0 64.6777 0 64.6777 168.735 129.355 168.735' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 1007 387)'/></g></svg>"))
            PressedBorderColor: =RGBA(0, 0, 0, 0)
            PressedFill: =RGBA(0, 0, 0, 0)
            Visible: =ddlStageCondition.Selected.Value <> 'Business Approval Stage Condition'.None
            Width: =300
            X: =radSwitchPaths.X
            Y: =radSwitchPaths.Y + radSwitchPaths.Height + 2
            ZIndex: =9

        radSwitchPaths As radio:
            BorderColor: =RGBA(51, 51, 51, 1)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            Default: =If(Self.Visible, Max(_selectedStage.Paths,3))
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisplayMode: =ddlStageCondition.DisplayMode
            FocusedBorderThickness: =0
            Font: =Font.'Segoe UI'
            Height: =If(Self.Visible, 30, 0)
            HoverColor: =RGBA(51, 51, 51, 1)
            HoverFill: =RGBA(0, 0, 0, 0)
            Items: =[ 2, 3, 4, 5]
            Layout: =Layout.Horizontal
            OnChange: |
                =With({ count: CountRows(_conditions), newCount: radSwitchPaths.Selected.Value },
                    If(count > newCount, 
                        //new paths is less than current - remove last n conditions
                        //push paths that are to be removed into temp stack then remove
                        Collect(_removedConditions, 
                            ShowColumns(Filter(_conditions, Path > newCount), "ConditionId", "Path", "Target", "TargetData", "StaticValue", "TargetStage")
                        );
                        RemoveIf(_conditions, Path > newCount),
                
                        //new paths is more than current - add conditions
                        Collect(_conditions,
                            ForAll(Sequence(newCount - count, count + 1),                 
                                Coalesce(
                                    LookUp(_removedConditions, Path = Value),
                                    { 
                                        ConditionId: Blank(), TargetData: Blank(), StaticValue: "", TargetStage: Blank(),
                                        Path: Value, Text: "Path " & Value, 
                                        Target: 'Business Approval Condition Target Data'.'Static value',
                                        IsDefault: false, IsParallel: false
                                    }
                                )
                            )
                        );
                
                        //pop from temp stack for any conditions that has been restored back
                        RemoveIf(_removedConditions, Path <= newCount);
                    );
                    //clear any condition from default, if exist
                    UpdateIf(_conditions, IsDefault, { IsDefault: false, StaticValue: ""});
                    //update last path to default
                    Patch(_conditions, Last(_conditions), { IsDefault: true, StaticValue: "Default (Other values)" })
                );
            PaddingBottom: =0
            PaddingTop: =2
            PressedColor: =RGBA(51, 51, 51, 1)
            PressedFill: =RGBA(0, 0, 0, 0)
            RadioBorderColor: =RGBA(51, 51, 51, 1)
            RadioSelectionFill: =RGBA(0, 120, 212, 1)
            RadioSize: =25
            Size: =10
            Visible: =lblSwitchPaths.Visible
            Width: =ddlStageCondition.Width
            X: =txtStageName.X
            Y: =lblSwitchPaths.Y
            ZIndex: =10

        lblSwitchPaths As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="Paths"
            Visible: =ddlStageCondition.Selected.Value = 'Business Approval Stage Condition'.Switch
            Width: =120
            X: =lblStageCondition.X
            Y: =lblStageCondition.Y + lblStageCondition.Height + 10
            ZIndex: =11

        lblFirstStageNoCondition As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="This is the first stage for the process. Conditional rules are not applicable."
            Visible: =_currentStageIndex < 2
            Width: =lblStageCondition.Width + ddlStageCondition.Width
            X: =lblStageCondition.X
            Y: =lblStageCondition.Y + lblStageCondition.Height + 10
            ZIndex: =12

        lblStageConditionSource As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            FontWeight: =Normal
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="Source"
            Visible: =ddlStageCondition.Selected.Value <> 'Business Approval Stage Condition'.None && ddlStageCondition.Visible
            Width: =120
            X: =lblStageName.X
            Y: =imgWorkflowDiagram.Y + imgWorkflowDiagram.Height + 10
            ZIndex: =13

        ddlStageConditionSource As dropdown:
            BorderColor: =RGBA(166, 166, 166, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(255, 255, 255, 1)
            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
            ChevronFill: =RGBA(33, 33, 33, 1)
            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
            ChevronHoverFill: =RGBA(33, 33, 33, 1)
            Color: =RGBA(51, 51, 51, 1)
            Default: =_selectedStage.'Source Data Type'
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            DisplayMode: =If(_currentStageIndex < 2, Disabled, DisplayMode.Edit)
            FocusedBorderThickness: =1
            Font: =Font.'Segoe UI'
            Height: =30
            HoverBorderColor: =Self.BorderColor
            HoverFill: =RGBA(243, 242, 241, 1)
            Items: =Choices('Business Approval Condition Source Data')
            OnChange: =Reset(ddlStageOperand)
            PaddingBottom: =5
            PaddingLeft: =5
            PaddingRight: =5
            PaddingTop: =5
            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
            PressedFill: =Self.HoverFill
            SelectionColor: =Self.Color
            SelectionFill: =RGBA(243, 242, 241, 1)
            Size: =10
            Visible: =lblStageConditionSource.Visible
            Width: =txtStageDesc.Width
            X: =ddlStageCondition.X
            Y: =lblStageConditionSource.Y
            ZIndex: =14

        lblRequestDataCondition As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =If(Self.Visible, 30, 0)
            PaddingLeft: =12
            Size: =10
            Text: ="Request Data"
            Visible: =ddlStageConditionSource.Selected.Value = 'Business Approval Condition Source Data'.'Request Data' && ddlStageConditionSource.Visible
            Width: =120
            X: =lblStageName.X
            Y: =lblStageConditionSource.Y + lblStageConditionSource.Height + If(Self.Visible, 10, 0)
            ZIndex: =15

        ddlRequestDataCondition As dropdown:
            BorderColor: =RGBA(166, 166, 166, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(255, 255, 255, 1)
            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
            ChevronFill: =RGBA(33, 33, 33, 1)
            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
            ChevronHoverFill: =RGBA(33, 33, 33, 1)
            Color: =RGBA(51, 51, 51, 1)
            Default: =_selectedStage.'Source Data'.Name
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            DisplayMode: =If(_currentStageIndex < 2, Disabled, DisplayMode.Edit)
            FocusedBorderThickness: =1
            Font: =Font.'Segoe UI'
            Height: =lblRequestDataCondition.Height
            HoverBorderColor: =Self.BorderColor
            HoverFill: =RGBA(243, 242, 241, 1)
            Items: |-
                =Filter(
                    Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                    Process.'Business Approval Process' = _selectedProcess.'Business Approval Process'
                )
            OnChange: |-
                =UpdateIf(_conditions, true, { TargetData: Blank() }) //clear all target data value if exists
            PaddingBottom: =5
            PaddingLeft: =5
            PaddingRight: =5
            PaddingTop: =5
            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
            PressedFill: =Self.HoverFill
            SelectionColor: =Self.Color
            SelectionFill: =RGBA(243, 242, 241, 1)
            Size: =10
            Visible: =lblRequestDataCondition.Visible
            Width: =txtStageDesc.Width
            X: =ddlStageCondition.X
            Y: =lblRequestDataCondition.Y
            ZIndex: =16

        lblRequestDataIsEmpty As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(255, 0, 0, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(255, 255, 255, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =ddlRequestDataCondition.Height
            Size: =10
            Text: ="No request data available. Create new request data in the process edit screen."
            Visible: |-
                =With({ condData:
                     Filter(
                        Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                        Process.'Business Approval Process' = _selectedProcess.'Business Approval Process'
                    )},
                    IsEmpty(condData) && ddlStageConditionSource.Visible && 
                    ddlStageConditionSource.Selected.Value = 'Business Approval Condition Source Data'.'Request Data'
                )
            Width: =ddlRequestDataCondition.Width
            X: =ddlRequestDataCondition.X
            Y: =ddlRequestDataCondition.Y
            ZIndex: =17

        lblRequestDataDetails As label:
            AutoHeight: =true
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            PaddingLeft: =12
            Size: =10
            Text: |-
                ="Default value: " & Coalesce(ddlRequestDataCondition.Selected.'Default Value', "Not specified.")
            Visible: =ddlRequestDataCondition.Visible && !lblRequestDataIsEmpty.Visible
            Width: =Parent.Width - Self.X - 100
            X: =ddlRequestDataCondition.X + ddlRequestDataCondition.Width
            Y: =ddlRequestDataCondition.Y
            ZIndex: =18

        lblParallelConditions As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="Switch conditions are parallel rules. You can have one or more paths with the same condition to create parallel paths."
            Visible: =galConditions.Visible && ddlStageCondition.Selected.Value = 'Business Approval Stage Condition'.Switch
            Width: =galConditions.Width
            X: =lblStageName.X
            Y: =galConditions.Y + galConditions.Height
            ZIndex: =19

        galConditions As gallery.galleryVertical:
            BorderColor: =RGBA(166, 166, 166, 1)
            Height: =120
            Items: =SortByColumns(_conditions, "Path", Ascending)
            Layout: =Layout.Vertical
            TemplatePadding: =0
            TemplateSize: =118
            Visible: |-
                =CountRows(Self.AllItems) > 0 && ddlStageCondition.Selected.Value <> 'Business Approval Stage Condition'.None && 
                ddlStageOperand.Selected.Value <> 'Business Approval Condition Operand'.'Is Blank' &&
                ddlStageOperand.Selected.Value <> 'Business Approval Condition Operand'.'Is Not Blank'
            Width: |-
                =If(ddlStageCondition.Selected.Value = 'Business Approval Stage Condition'.'If/Else',
                    txtStageName.Width,
                    Parent.Width - Self.X - 20
                )
            WrapCount: =CountRows(Self.AllItems)
            X: =If(ddlStageCondition.Selected.Value = 'Business Approval Stage Condition'.'If/Else', txtStageName.X, lblStageName.X)
            Y: =lblStageOperand.Y + lblStageOperand.Height + 20
            ZIndex: =20

            Rectangle3 As rectangle:
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                DisplayMode: =DisplayMode.Disabled
                Fill: =RGBA(230, 230, 230, 1)
                FocusedBorderThickness: =4
                Height: =Parent.TemplateHeight
                HoverFill: =RGBA(105, 121, 126, 1)
                OnSelect: =Select(Parent)
                PressedFill: =RGBA(105, 121, 126, 1)
                Width: =Parent.TemplateWidth - 2
                ZIndex: =1

            lblConditionTarget As label:
                Align: =Align.Center
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(51, 51, 51, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =30
                PaddingLeft: =12
                Size: =9
                Text: |-
                    =If(ThisItem.IsDefault, "Default", "If " & 
                        If(ddlRequestDataCondition.Visible, ddlRequestDataCondition.Selected.Name, ddlStageConditionSource.Selected.Value) & " " &
                        ddlStageOperand.Selected.Value
                    )
                Width: =Parent.TemplateWidth
                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                Y: =5
                ZIndex: =2

            ddlConditionTarget As dropdown:
                BorderColor: =RGBA(166, 166, 166, 1)
                BorderThickness: =1
                ChevronBackground: =RGBA(255, 255, 255, 1)
                ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                ChevronFill: =RGBA(33, 33, 33, 1)
                ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                ChevronHoverFill: =RGBA(33, 33, 33, 1)
                Color: =RGBA(51, 51, 51, 1)
                Default: =If(Self.DisplayMode = DisplayMode.Disabled, 'Business Approval Condition Target Data'.'Static value', ThisItem.Target)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                DisplayMode: =txtTargetStatic.DisplayMode
                FocusedBorderThickness: =1
                Font: =Font.'Segoe UI'
                Height: =30
                HoverBorderColor: =Self.BorderColor
                HoverFill: =RGBA(243, 242, 241, 1)
                Items: =Choices('Business Approval Condition Target Data')
                OnChange: |-
                    =Patch(_conditions, ThisItem, { Target: Self.Selected.Value, TargetData: Blank() })
                PaddingBottom: =5
                PaddingLeft: =5
                PaddingRight: =5
                PaddingTop: =5
                PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                PressedFill: =Self.HoverFill
                SelectionColor: =Self.Color
                SelectionFill: =RGBA(243, 242, 241, 1)
                Size: =10
                Width: =Min(txtStageName.Width, Parent.TemplateWidth - 20)
                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                Y: =lblConditionTarget.Y + lblConditionTarget.Height
                ZIndex: =3

            ddlTargetRequestData As dropdown:
                AllowEmptySelection: =true
                BorderColor: =RGBA(166, 166, 166, 1)
                BorderThickness: =1
                ChevronBackground: =RGBA(255, 255, 255, 1)
                ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                ChevronFill: =RGBA(33, 33, 33, 1)
                ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                ChevronHoverFill: =RGBA(33, 33, 33, 1)
                Color: =RGBA(51, 51, 51, 1)
                Default: =ThisItem.TargetData.Name
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                FocusedBorderThickness: =1
                Font: =Font.'Segoe UI'
                Height: =If(Self.Visible, 30, 0)
                HoverBorderColor: =Self.BorderColor
                HoverFill: =RGBA(243, 242, 241, 1)
                Items: |-
                    =Filter(
                        Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                        Process.'Business Approval Process' = _selectedProcess.'Business Approval Process' && 
                        'Business Approval Data' <> ddlRequestDataCondition.Selected.'Business Approval Data' &&
                        'Data Type' = ddlRequestDataCondition.Selected.'Data Type'
                    )
                OnChange: |-
                    =Patch(_conditions, ThisItem, { TargetData: Self.Selected, StaticValue: Blank()})
                PaddingBottom: =5
                PaddingLeft: =5
                PaddingRight: =5
                PaddingTop: =5
                PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                PressedFill: =Self.HoverFill
                SelectionColor: =Self.Color
                SelectionFill: =RGBA(243, 242, 241, 1)
                Size: =10
                Visible: =ddlConditionTarget.Selected.Value = 'Business Approval Condition Target Data'.'Request Data' && ThisItem.IsDefault = false
                Width: =ddlConditionTarget.Width
                X: =ddlConditionTarget.X
                Y: =ddlConditionTarget.Y + ddlConditionTarget.Height + 10
                ZIndex: =4

            txtTargetStatic As text:
                BorderColor: =RGBA(166, 166, 166, 1)
                Clear: =true
                Color: =RGBA(51, 51, 51, 1)
                Default: =ThisItem.StaticValue
                DelayOutput: =true
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                DisplayMode: =If(ThisItem.IsDefault, DisplayMode.Disabled, DisplayMode.Edit)
                FocusedBorderThickness: =1
                Font: =Font.'Segoe UI'
                Height: =30
                HoverBorderColor: =Self.BorderColor
                HoverColor: =RGBA(51, 51, 51, 1)
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =100
                OnChange: |-
                    =Patch(_conditions, ThisItem, { StaticValue: Self.Text, TargetData: Blank() })
                PaddingLeft: =5
                PressedBorderColor: =Self.BorderColor
                PressedColor: =RGBA(51, 51, 51, 1)
                PressedFill: =RGBA(255, 255, 255, 1)
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =10
                Visible: =!ddlTargetRequestData.Visible
                Width: =ddlConditionTarget.Width
                X: =ddlConditionTarget.X
                Y: =ddlConditionTarget.Y + ddlConditionTarget.Height + 10
                ZIndex: =5

            lblStageTargetRequestDataNotFound As label:
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(51, 51, 51, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Fill: =RGBA(230, 230, 230, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                Height: =ddlTargetRequestData.Height
                OnSelect: =Select(Parent)
                Size: =10
                Text: ="No other data field found of similar data type for " & ddlRequestDataCondition.Selected.Name & " (" & ddlRequestDataCondition.Selected.'Data Type' & ")"
                Visible: |-
                    =With({ conditionData: Filter(
                        Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                        Process.'Business Approval Process' = _selectedProcess.'Business Approval Process' && 
                        'Business Approval Data' <> ddlRequestDataCondition.Selected.'Business Approval Data' &&
                        'Data Type' = ddlRequestDataCondition.Selected.'Data Type')},
                        ddlTargetRequestData.Visible && IsEmpty(conditionData)
                    )
                Width: =ddlTargetRequestData.Width
                X: =ddlTargetRequestData.X
                Y: =ddlTargetRequestData.Y
                ZIndex: =6

            lblIsParallel As label:
                Align: =Align.Center
                BorderColor: =RGBA(73, 84, 88, 1)
                BorderThickness: =1
                Color: =RGBA(51, 51, 51, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                FontWeight: =FontWeight.Semibold
                Height: =lblConditionTarget.Height - 5
                Size: =lblConditionTarget.Size
                Text: ="="
                Tooltip: ="Parallel paths"
                Visible: |-
                    =!IsBlank(LookUp(_conditions, Path <> ThisItem.Path && Target = ThisItem.Target && IsDefault = false &&
                        If(ThisItem.Target = 'Business Approval Condition Target Data'.'Static value',
                            StaticValue = txtTargetStatic.Text,
                            TargetData.'Business Approval Data' = ddlTargetRequestData.Selected.'Business Approval Data')
                        )
                    ) && !ThisItem.IsDefault
                Width: =Self.Height
                X: =ddlConditionTarget.X
                Y: =lblConditionTarget.Y
                ZIndex: =7

        lblStageOperand As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =30
            PaddingLeft: =12
            Size: =10
            Text: ="Operand"
            Visible: =lblStageConditionSource.Visible
            Width: =120
            X: =lblStageName.X
            Y: =lblRequestDataCondition.Y + lblRequestDataCondition.Height + 10
            ZIndex: =21

        ddlStageOperand As dropdown:
            BorderColor: =RGBA(166, 166, 166, 1)
            BorderThickness: =1
            ChevronBackground: =RGBA(255, 255, 255, 1)
            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
            ChevronFill: =RGBA(33, 33, 33, 1)
            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
            ChevronHoverFill: =RGBA(33, 33, 33, 1)
            Color: =RGBA(51, 51, 51, 1)
            Default: |-
                =With({ operand: _selectedStage.Operand}, 
                    If(IsBlank(operand) || ddlStageCondition.Selected.Value = 'Business Approval Stage Condition'.Switch, 
                        'Business Approval Condition Operand'.'Equals (=)', operand
                    )
                )
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            DisplayMode: |-
                =If(
                    ddlStageCondition.Selected.Value = 'Business Approval Stage Condition'.Switch ||
                    ddlStageConditionSource.Selected.Value = 'Business Approval Condition Source Data'.'Previous Node Outcome' ||
                    lblRequestDataIsEmpty.Visible, 
                    Disabled, DisplayMode.Edit
                )
            FocusedBorderThickness: =1
            Font: =Font.'Segoe UI'
            Height: =30
            HoverBorderColor: =Self.BorderColor
            HoverFill: =RGBA(243, 242, 241, 1)
            Items: |-
                =If(ddlStageConditionSource.Selected.Value = 'Business Approval Condition Source Data'.'Request Data',
                    LookUp(_operands, ddlRequestDataCondition.Selected.'Data Type' in type).operands,
                    [ 'Business Approval Condition Operand'.'Equals (=)' ]
                )
            OnChange: |-
                =If(Self.Selected.Value = 'Business Approval Condition Operand'.'Is Blank' || 
                Self.Selected.Value = 'Business Approval Condition Operand'.'Is Not Blank', 
                    Patch(_conditions, First(_conditions), { StaticValue: ""})
                )
            PaddingBottom: =5
            PaddingLeft: =5
            PaddingRight: =5
            PaddingTop: =5
            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
            PressedFill: =Self.HoverFill
            SelectionColor: =Self.Color
            SelectionFill: =RGBA(243, 242, 241, 1)
            Size: =10
            Visible: =lblStageConditionSource.Visible
            Width: =txtStageDesc.Width
            X: =ddlStageCondition.X
            Y: =lblStageOperand.Y
            ZIndex: =22

        btnResetConditions As button:
            BorderColor: =RGBA(0, 0, 0, 0)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            Fill: =RGBA(105, 121, 126, 1)
            FocusedBorderColor: =ColorFade(Self.Fill, -75%)
            Font: =Font.'Segoe UI'
            FontWeight: =FontWeight.Semibold
            Height: =30
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(105, 121, 126, 1), -10%)
            OnSelect: |-
                =If(Self.Text = "Edit",
                    //saves current condition in memory
                    ClearCollect(_savedConditions, _conditions);
                    UpdateContext({ allowUpdateConditionType: true, isCleared: true }),
                
                    //restore saved conditions back from memory
                    ClearCollect(_conditions, _savedConditions);
                    Clear(_savedConditions); Clear(_removedConditions);
                    Reset(ddlStageCondition);
                    UpdateContext({ allowUpdateConditionType: false, isCleared: false })
                )
            PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =10
            Text: =If(isCleared, "Reset", "Edit")
            Visible: =(!allowUpdateConditionType || isCleared) && _currentStageIndex > 1
            Width: =90
            X: =ddlStageCondition.X + ddlStageCondition.Width + 20
            Y: =244
            ZIndex: =23

        lblResetConditions As label:
            AutoHeight: =true
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(166, 166, 166, 1)
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            FontWeight: =Lighter
            Height: =3
            PaddingLeft: =0
            PaddingRight: =0
            Size: =10
            Text: |-
                ="Currently editing a stage with Conditions defined. Click 'Edit' to change and 'Reset' to undo. Warning: Removing conditions removes the corresponding paths and its nodes."
            Visible: =btnResetConditions.Visible
            Width: =txtStageName.Width
            X: =txtStageName.X
            Y: =lblStageConditionHeader.Y
            ZIndex: =24

        Dependencies As groupContainer:
            Height: =Min(lblRequestDataDetails.Y - 20, 300)
            Visible: =CountRows(galStageDeps.AllItems) > 0
            Width: =Parent.Width - Self.X - 20
            X: =txtStageName.X + txtStageName.Width + 20
            Y: =txtStageName.Y
            ZIndex: =25

            galStageDeps As gallery.galleryVertical:
                BorderColor: =RGBA(166, 166, 166, 1)
                BorderThickness: =1
                Height: =Min(Parent.Height - Self.Y, CountRows(Self.AllItems) * Self.TemplateHeight)
                Items: =_selectedStage.'Business Approval Conditions (cat_BusinessApprovalCondition_GoToStage_c)'
                Layout: =Layout.Vertical
                TemplatePadding: =0
                TemplateSize: =30
                Width: =Parent.Width - Self.X - 10
                X: =5
                Y: =tblStageDeps.Y + tblStageDeps.Height
                ZIndex: =1

                lblStageDepStageName As label:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    Color: =RGBA(51, 51, 51, 1)
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    FocusedBorderThickness: =4
                    Font: =Font.'Segoe UI'
                    FontWeight: =Lighter
                    Height: =30
                    OnSelect: =Select(Parent)
                    Size: =10
                    Text: =ThisItem.Node.'Stage Name Value'
                    Tooltip: =Self
                    Width: =Parent.Width / 4
                    Wrap: =false
                    ZIndex: =1

                lblStageDepNodeName As label:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    Color: =RGBA(51, 51, 51, 1)
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    FocusedBorderThickness: =4
                    Font: =Font.'Segoe UI'
                    FontWeight: =Lighter
                    Height: =30
                    OnSelect: =Select(Parent)
                    Size: =10
                    Text: =ThisItem.Node.Name
                    Tooltip: =Self.Text
                    Width: =Parent.Width / 4
                    Wrap: =false
                    X: =lblStageDepStageName.Width
                    ZIndex: =2

                lblStageDepNodeCond As label:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    Color: =RGBA(51, 51, 51, 1)
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledColor: =RGBA(166, 166, 166, 1)
                    FocusedBorderThickness: =4
                    Font: =Font.'Segoe UI'
                    FontWeight: =Lighter
                    Height: =30
                    OnSelect: =Select(Parent)
                    Size: =10
                    Text: =ThisItem.Node.'Source Data Name Value' & " " & ThisItem.Node.Operand & " " & ThisItem.'Condition Value Display'
                    Tooltip: =Self.Text
                    Width: =Parent.Width / 2
                    Wrap: =false
                    X: =lblStageDepNodeName.X + lblStageDepNodeName.Width
                    ZIndex: =3

            tblStageDeps As TableHeader:
                ColumnOnClick: ="Text"
                Columns: |-
                    =Table(
                        { Index: 1, Text: "Stage", Column: "Stage", Width: Self.Width / 4, Offset: 0, EnableSort: false },    
                        { Index: 2, Text: "Node", Column: "Name", Width: Self.Width / 4, Offset: -Self.Width / 4, EnableSort: false },
                        { Index: 3, Text: "Condition", Column: "Condition", Width: Self.Width / 2, Offset: -Self.Width / 2, EnableSort: false }
                    )
                EnableSort: =false
                Width: =galStageDeps.Width
                X: =5
                Y: =lblStageHasDeps.Height
                ZIndex: =2

            lblStageHasDeps As label:
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(51, 51, 51, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                FocusedBorderThickness: =4
                Font: =Font.'Segoe UI'
                FontWeight: =Lighter
                Height: =30
                Size: =10
                Text: ="This stage has the following dependencies and cannot be deleted until the dependencies are removed."
                Width: =Parent.Width
                ZIndex: =3

        Toolbar_4 As Toolbar:
            DisabledItems: |
                =If(
                    //disables save if no stage name provided, or if there are any static value conditions without any value provided
                    Len(txtStageName.Text) = 0 || lblRequestDataIsEmpty.Visible ||
                    (galConditions.Visible && (lblStageTargetRequestDataNotFound.Visible ||
                        (!IsBlank(LookUp(_conditions, Target = 'Business Approval Condition Target Data'.'Static value' && IsBlank(StaticValue))) ||
                        !IsBlank(LookUp(_conditions, Target = 'Business Approval Condition Target Data'.'Request Data' && IsBlank(TargetData)))))),
                    ["Save", "Save & Back", "Delete"],
                    IsBlank(_selectedStage) || Dependencies.Visible, [ "Delete" ]
                )
            OnClick: |-
                =If(MenuItem = "Delete", 
                    Set(_showConfirm, true),
                
                    //save stage configuration
                    UpdateContext({ busyMessage: "Saving Stage - " & txtStageName.Text });
                    Set(_isBusy, true);
                
                    Set(_selectedStage, 
                        Patch('Business Approval Stages', 
                            If(IsBlank(_selectedStage), Defaults('Business Approval Stages'), _selectedStage),
                            {
                                Name: txtStageName.Text, Description: txtStageDesc.Text, 'Stage Condition': ddlStageCondition.Selected.Value, 
                                'Source Data Type': If(ddlStageConditionSource.Visible, ddlStageConditionSource.Selected.Value, Blank()), 
                                'Source Data': If(ddlRequestDataCondition.Visible, ddlRequestDataCondition.Selected, Blank()),
                                Operand: If(ddlStageOperand.Visible, ddlStageOperand.Selected.Value, Blank()), 
                                Order: _currentStageIndex,
                                Paths:
                                    Switch(ddlStageCondition.Selected.Value, 'Business Approval Stage Condition'.None, 1,
                                        'Business Approval Stage Condition'.'If/Else', 2, radSwitchPaths.Selected.Value
                                    ),
                                Process: _selectedProcess
                            }
                        )
                    );
                
                    //remove any conditions that has been removed and clear the stack
                    RemoveIf('Business Approval Conditions', 'Business Approval Condition' in _removedConditions.ConditionId);
                
                    //remove any nodes that are in the removed condition paths
                    RemoveIf('Business Approval Nodes', 
                        Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage' && 'Path Index' in _removedConditions.Path
                    );
                
                    //save conditions
                    Clear(_addedConditions);
                    If(CountRows(_conditions) > 0, UpdateContext({ busyMessage: "Updating Conditions..." }));
                    ForAll(_conditions As conds,        
                        With({ conditionId: GUID(conds.ConditionId)},
                            With({ condition:  LookUp('Business Approval Conditions', 'Business Approval Condition' = conditionId) },
                                With({ addedCondition: 
                                    Patch('Business Approval Conditions', 
                                        Coalesce(condition, Defaults('Business Approval Conditions')),
                                        {
                                            'Path Index': conds.Path,                         
                                            'Condition Data Type': If(conds.IsDefault, 'Business Approval Condition Target Data'.'Static value', conds.Target), 
                                            Process: _selectedProcess,
                                            'Condition Data': 
                                                If(conds.Target = 'Business Approval Condition Target Data'.'Request Data' && !conds.IsDefault, 
                                                    conds.TargetData, Blank()),
                                            Stage: _selectedStage, 
                                            'Condition Value': 
                                                If(conds.Target = 'Business Approval Condition Target Data'.'Static value', conds.StaticValue, Blank()),
                                            'Is Parallel': 
                                                !IsBlank(LookUp(_conditions, Path <> conds.Path && Target = conds.Target && IsDefault = false &&
                                                    If(conds.Target = 'Business Approval Condition Target Data'.'Static value',
                                                        StaticValue = conds.StaticValue, 
                                                        TargetData.'Business Approval Data' = conds.TargetData.'Business Approval Data'
                                                    )
                                                )) && !conds.IsDefault,
                                            'Is Default': 
                                                If(conds.IsDefault, 'Is Default (Business Approval Conditions)'.Yes, 'Is Default (Business Approval Conditions)'.No)
                                        }
                                    )},
                                    If(IsBlank(condition), 
                                        //track newly added condition
                                        Collect(_addedConditions, { Id: addedCondition.'Business Approval Condition', Path: addedCondition.'Path Index'})
                                    );
                                )
                            )
                        )
                    );
                
                    //update in memory Condition for any newly added Condition Guids
                    ForAll(_addedConditions As added, UpdateIf(_conditions, Path = added.Path, { ConditionId: added.Id }));
                    Set(_isBusy, false);
                
                    If(MenuItem = "Save & Back", Back())
                )
            TemplateWidth: =130
            ToolbarItems: |-
                =Table(
                    { Icon: Icon.Save, Text: "Save", Offset: 0 },
                    { Icon: Icon.BackArrow, Text: "Save & Back", Offset: -40 },
                    { Icon: Icon.Trash, Text: "Delete", Offset: -30 }
                )
            Width: =Parent.Width
            ZIndex: =26

        ConfirmDialog_3 As ConfirmDialog:
            ConfirmText: ="Deleting Stage - " & _selectedStage.Name & ". This will also delete all approval nodes in this stage and it cannot be undone. Are you sure?"
            Height: =Parent.Height
            OnClick: |-
                =If(IsConfirmed,
                    UpdateContext({ busyMessage: "Deleting Stage - " & _selectedStage.Name });
                    Set(_isBusy, true);
                
                    Concurrent(
                        //remove stage
                        Remove('Business Approval Stages', _selectedStage),
                
                        //remove nodes
                        RemoveIf('Business Approval Nodes', Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage'),
                
                        //remove node conditions
                        RemoveIf('Business Approval Conditions', 
                            Node.'Business Approval Node' in 
                            _selectedStage.'Business Approval Nodes (cat_BusinessApprovalNode_Stage_cat_Busine)'.'Business Approval Node'
                        ); 
                        //remove stage conditions
                        RemoveIf('Business Approval Conditions', Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage')
                    );
                
                    Set(_selectedStage, Blank());
                    Set(_isBusy, false);
                    Set(_showConfirm, false);
                    Back(),
                    Set(_showConfirm, false)
                )
            Visible: =_showConfirm
            Width: =Parent.Width
            ZIndex: =27

        BusyScreen_3 As BusyScreen:
            BusyMessage: =busyMessage
            Fill: =RGBA(255, 255, 255, 0.8)
            Height: =Parent.Height
            Visible: =_isBusy
            Width: =Parent.Width
            ZIndex: =28

    Image1_4 As image:
        BorderColor: =RGBA(0, 0, 0, 0)
        BorderStyle: =BorderStyle.None
        BorderThickness: =2
        DisabledBorderColor: =RGBA(0, 0, 0, 0)
        DisabledFill: =RGBA(0, 0, 0, 0)
        FocusedBorderThickness: =4
        Height: =Menu_5.Height
        HoverBorderColor: =RGBA(0, 0, 0, 0)
        HoverFill: =RGBA(0, 0, 0, 0)
        Image: =gradient_top
        ImagePosition: =ImagePosition.Stretch
        ImageRotation: =ImageRotation.Rotate90
        PressedBorderColor: =RGBA(0, 0, 0, 0)
        PressedFill: =RGBA(0, 0, 0, 0)
        Width: =4
        X: =Menu_5.Width
        Y: =Menu_5.Y
        ZIndex: =2

    Menu_5 As Menu:
        Height: =Parent.Height - Self.Y
        MenuItems: =_menu
        OnHamburgerClick: =Set(_hideMenu, !_hideMenu)
        Width: =If(_hideMenu, 45, 200)
        Y: =Header_5.Height
        ZIndex: =3

    Header_5 As Header:
        Height: =60
        ShowRefresh: =false
        Title: =_appConfig.Title
        Width: =Parent.Width
        ZIndex: =4

