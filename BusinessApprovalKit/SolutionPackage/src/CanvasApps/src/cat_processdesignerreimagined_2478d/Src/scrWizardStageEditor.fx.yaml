scrWizardStageEditor As screen:
    LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
    OnVisible: |-
        =//cache operands if not already available
        If(IsEmpty(_operands),
            ClearCollect(_operands, 
                { 
                    operands: [
                        'Business Approval Condition Operand'.'Equals (=)', 'Business Approval Condition Operand'.'Not Equal (<>)',
                        'Business Approval Condition Operand'.'Starts With', 'Business Approval Condition Operand'.'Ends With',
                        'Business Approval Condition Operand'.Contains, 'Business Approval Condition Operand'.'Is Blank',
                        'Business Approval Condition Operand'.'Is Not Blank'
                    ],
                    type: [ 'Business Approval Data Type'.Text, 'Business Approval Data Type'.'User (Email)' ]
                },
                { 
                    operands: [
                        'Business Approval Condition Operand'.'Equals (=)', 'Business Approval Condition Operand'.'Less Than (<)',
                        'Business Approval Condition Operand'.'Less Than or Equals (<=)', 'Business Approval Condition Operand'.'Greater Than (>)',
                        'Business Approval Condition Operand'.'Greater Than or Equals (>=)', 'Business Approval Condition Operand'.'Not Equal (<>)',
                        'Business Approval Condition Operand'.'Is Blank', 'Business Approval Condition Operand'.'Is Not Blank'
                    ],
                    type: [ 'Business Approval Data Type'.Number, 'Business Approval Data Type'.Date ]
                },
                { 
                    operands: [
                        'Business Approval Condition Operand'.'Equals (=)', 'Business Approval Condition Operand'.'Not Equal (<>)',
                        'Business Approval Condition Operand'.'Is Blank', 'Business Approval Condition Operand'.'Is Not Blank'
                    ],
                    type: [ 'Business Approval Data Type'.Boolean ]
                }
            )
        );
        
        //load conditions if exists
        Clear(_conditions);
        ForAll(
            Filter(
                Filter('Business Approval Conditions','Business Approval Conditions (Views)'.'Active Stage Conditions'),
                Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage'
            ),
            Collect(_conditions, 
            { 
                ConditionId: ThisRecord.'Business Approval Condition', Path: ThisRecord.'Path Index', 
                Target: ThisRecord.'Condition Data Type', TargetData: ThisRecord.'Condition Data', 
                StaticValue: ThisRecord.'Condition Value', 
                IsDefault: ThisRecord.'Is Default' = 'Is Default (Business Approval Conditions)'.Yes,
                IsParallel: ThisRecord.'Is Parallel' = 'Is Parallel (Business Approval Conditions)'.Yes
            })
        );
        
        //allow change of condition type if there are no existing conditions defined
        //isCleared - tracks if the user clicked on "Clear" (may not yet proceed to change condition, as they can undo it)
        UpdateContext({ allowUpdateConditionType: CountRows(_conditions) = 0, isCleared: false });
        
        SetFocus(txtStageName_1)

    RootContainer_4 As groupContainer.verticalAutoLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: =RGBA(245, 245, 245, 1)
        Height: =Parent.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =16
        LayoutMode: =LayoutMode.Auto
        PaddingBottom: =16
        PaddingLeft: =16
        PaddingRight: =16
        PaddingTop: =16
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Width: =Parent.Width
        ZIndex: =1

        Container4_4 As groupContainer.verticalAutoLayoutContainer:
            DropShadow: =DropShadow.Light
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =1
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            ZIndex: =1

            Container12_7 As groupContainer.verticalAutoLayoutContainer:
                Fill: =RGBA(255, 255, 255, 1)
                FillPortions: =0
                Height: =72
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =72
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                ZIndex: =1

                Container11_7 As groupContainer.manualLayoutContainer:
                    AlignInContainer: =AlignInContainer.Start
                    FillPortions: =0
                    Height: =Parent.Height
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    Width: =Parent.Width
                    ZIndex: =2

                    "Breadcrumb1_3 As 'Fluent Breadcrumb (1.0.22)'.pcfdataset":
                        DisplayMode: =DisplayMode.Edit
                        Height: =54
                        Items: |-
                            =Table(
                                {
                                    ItemKey: "1",
                                    ItemDisplayName: Coalesce(_selectedProcess.Name,"Workflow"),
                                    ItemClickable: false
                                },
                                {
                                    ItemKey: "2",
                                    ItemDisplayName: Coalesce(_selectedStage.Name, "(New Stage)"),
                                    ItemClickable: false
                                }
                            )
                        Width: =508
                        X: =15
                        Y: =11
                        ZIndex: =2

            Container10_3 As groupContainer.horizontalAutoLayoutContainer:
                Fill: =RGBA(255, 255, 255, 1)
                LayoutGap: =3
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =2

                Container11_8 As groupContainer.manualLayoutContainer:
                    FillPortions: =0
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    RadiusBottomLeft: =4
                    RadiusBottomRight: =4
                    RadiusTopLeft: =4
                    RadiusTopRight: =4
                    Width: =210
                    ZIndex: =1

                    "SubwayNav2_4 As 'SubwayNav (1.0.22) Preview'.pcfdataset":
                        DisplayMode: =DisplayMode.Disabled
                        Height: =486
                        Items: |-
                            =Table(
                                { ItemKey:"1", ItemLabel:"Create Workflow", ItemState:"Completed" },
                                { ItemKey:"2", ItemLabel:"Create Stages & Nodes", ItemState:"Current" },
                                /*{ ItemKey:"3", ItemLabel:"Create Nodes(Steps)", ItemState:"Unsaved" },*/
                                { ItemKey:"4", ItemLabel:"Publish", ItemState:"Unsaved" }
                            )
                        ShowAnimation: =false
                        Theme: =AppThemeJson
                        Width: =200
                        X: =10
                        Y: =24
                        ZIndex: =1

                recHeaderDevider_7 As rectangle:
                    AlignInContainer: =AlignInContainer.Start
                    BorderColor: =RGBA(166, 166, 166, 1)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    DisabledFill: =RGBA(166, 166, 166, 1)
                    Fill: =ColorValue(AppTheme.palette.neutralLight)
                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                    Height: =Parent.Height - 10
                    HoverFill: =RGBA(225, 223, 221, 1)
                    PressedFill: =RGBA(225, 223, 221, 1)
                    Width: =1
                    ZIndex: =3

                Container1_13 As groupContainer:
                    Height: =Parent.Height - Self.Y
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    PaddingBottom: =10
                    PaddingLeft: =10
                    PaddingRight: =10
                    PaddingTop: =10
                    Width: =Parent.Width - Self.X
                    ZIndex: =4

                    Container1_14 As groupContainer:
                        Height: =Parent.Height - Self.Y
                        Width: =Parent.Width - Self.X
                        ZIndex: =1

                        "CommandBar2_8 As 'Fluent Command Bar (1.0.22)'.pcfdataset":
                            DisplayMode: =DisplayMode.Edit
                            Height: =40
                            Items: |-
                                =Table(
                                    /*{
                                        ItemKey: "back",
                                        ItemDisplayName: "Back",
                                        ItemIconName: "NavigateBack"
                                    },*/
                                    {
                                        ItemKey: "save",
                                        ItemDisplayName: "Save",
                                        ItemIconName: "Save"
                                    },{
                                        ItemKey: "saveback",
                                        ItemDisplayName: "Save & Create Steps",
                                        ItemIconName: "SaveAndClose"
                                    },{
                                        ItemKey: "delete",
                                        ItemDisplayName: "Delete",
                                        ItemIconName: "Delete"
                                    }
                                )
                            OnSelect: |-
                                =If(Self.Selected.ItemKey = "back",Back(),
                                    If(Self.Selected.ItemKey = "delete", 
                                        Set(_showConfirm, true),
                                
                                        //save stage configuration
                                        UpdateContext({ busyMessage: "Saving Stage - " & txtStageName_1.Text });
                                        Set(_isBusy, true);
                                
                                        Set(_selectedStage, 
                                            Patch('Business Approval Stages', 
                                                If(IsBlank(_selectedStage), Defaults('Business Approval Stages'), _selectedStage),
                                                {
                                                    Name: txtStageName_1.Text, Description: txtStageDesc_1.Text, 'Stage Condition': ddlStageCondition_1.Selected.Value, 
                                                    'Source Data Type': If(ddlStageConditionSource_1.Visible, ddlStageConditionSource_1.Selected.Value, Blank()), 
                                                    'Source Data': If(ddlRequestDataCondition_1.Visible, ddlRequestDataCondition_1.Selected, Blank()),
                                                    Operand: If(ddlStageOperand_1.Visible, ddlStageOperand_1.Selected.Value, Blank()), 
                                                    Order: _currentStageIndex,
                                                    Paths:
                                                        Switch(ddlStageCondition_1.Selected.Value, 'Business Approval Stage Condition'.None, 1,
                                                            'Business Approval Stage Condition'.'If/Else', 2, radSwitchPaths_1.Selected.Value
                                                        ),
                                                    Process: _selectedProcess
                                                }
                                            )
                                        );
                                
                                        //remove any conditions that has been removed and clear the stack
                                        RemoveIf('Business Approval Conditions', 'Business Approval Condition' in _removedConditions.ConditionId);
                                
                                        //remove any nodes that are in the removed condition paths
                                        RemoveIf('Business Approval Nodes', 
                                            Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage' && 'Path Index' in _removedConditions.Path
                                        );
                                
                                        //save conditions
                                        Clear(_addedConditions);
                                        If(CountRows(_conditions) > 0, UpdateContext({ busyMessage: "Updating Conditions..." }));
                                        ForAll(_conditions As conds,        
                                            With({ conditionId: GUID(conds.ConditionId)},
                                                With({ condition:  LookUp('Business Approval Conditions', 'Business Approval Condition' = conditionId) },
                                                    With({ addedCondition: 
                                                        Patch('Business Approval Conditions', 
                                                            Coalesce(condition, Defaults('Business Approval Conditions')),
                                                            {
                                                                'Path Index': conds.Path,                         
                                                                'Condition Data Type': If(conds.IsDefault, 'Business Approval Condition Target Data'.'Static value', conds.Target), 
                                                                Process: _selectedProcess,
                                                                'Condition Data': 
                                                                    If(conds.Target = 'Business Approval Condition Target Data'.'Request Data' && !conds.IsDefault, 
                                                                        conds.TargetData, Blank()),
                                                                Stage: _selectedStage, 
                                                                'Condition Value': 
                                                                    If(conds.Target = 'Business Approval Condition Target Data'.'Static value', conds.StaticValue, Blank()),
                                                                'Is Parallel': 
                                                                    !IsBlank(LookUp(_conditions, Path <> conds.Path && Target = conds.Target && IsDefault = false &&
                                                                        If(conds.Target = 'Business Approval Condition Target Data'.'Static value',
                                                                            StaticValue = conds.StaticValue, 
                                                                            TargetData.'Business Approval Data' = conds.TargetData.'Business Approval Data'
                                                                        )
                                                                    )) && !conds.IsDefault,
                                                                'Is Default': 
                                                                    If(conds.IsDefault, 'Is Default (Business Approval Conditions)'.Yes, 'Is Default (Business Approval Conditions)'.No)
                                                            }
                                                        )},
                                                        If(IsBlank(condition), 
                                                            //track newly added condition
                                                            Collect(_addedConditions, { Id: addedCondition.'Business Approval Condition', Path: addedCondition.'Path Index'})
                                                        );
                                                    )
                                                )
                                            )
                                        );
                                
                                        //update in memory Condition for any newly added Condition Guids
                                        ForAll(_addedConditions As added, UpdateIf(_conditions, Path = added.Path, { ConditionId: added.Id }));
                                        Set(_isBusy, false);
                                
                                        If(Self.Selected.ItemKey = "saveback", Back())
                                    )
                                );
                            Theme: =AppThemeJson
                            Width: =Parent.Width
                            X: =0
                            Y: =0
                            ZIndex: =1

                        bcProcessStage_4 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =30
                            PaddingLeft: =0
                            Size: =10
                            Text: =_selectedProcess.Name & " > " & Coalesce(_selectedStage.Name, "(New Stage)")
                            Visible: =false
                            Width: =Parent.Width - Self.X - 20
                            Wrap: =false
                            X: =20
                            Y: =CommandBar2_8.Y + CommandBar2_8.Height
                            ZIndex: =2

                        lblStageName_3 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Name"
                            Width: =120
                            X: =bcProcessStage_4.X
                            Y: =bcProcessStage_4.Y + bcProcessStage_4.Height + 10
                            ZIndex: =3

                        txtStageName_1 As text:
                            BorderColor: =RGBA(166, 166, 166, 1)
                            Clear: =true
                            Color: =RGBA(51, 51, 51, 1)
                            Default: =_selectedStage.Name
                            DelayOutput: =true
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.'Segoe UI'
                            Height: =30
                            HoverBorderColor: =Self.BorderColor
                            HoverColor: =RGBA(51, 51, 51, 1)
                            HoverFill: =RGBA(255, 255, 255, 1)
                            MaxLength: =100
                            OnChange: =
                            PaddingLeft: =5
                            PressedBorderColor: =Self.BorderColor
                            PressedColor: =RGBA(51, 51, 51, 1)
                            PressedFill: =RGBA(255, 255, 255, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =10
                            Width: =(Parent.Width - Self.X) / 2
                            X: =140
                            Y: =lblStageName_3.Y
                            ZIndex: =4

                        lblStageDesc_4 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Description"
                            Width: =120
                            X: =lblStageName_3.X
                            Y: =lblStageName_3.Y + lblStageName_3.Height + 10
                            ZIndex: =5

                        txtStageDesc_1 As text:
                            BorderColor: =RGBA(166, 166, 166, 1)
                            Clear: =true
                            Color: =RGBA(51, 51, 51, 1)
                            Default: =_selectedStage.Description
                            DelayOutput: =true
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            FocusedBorderThickness: =1
                            Font: =Font.'Segoe UI'
                            Height: =60
                            HoverBorderColor: =Self.BorderColor
                            HoverColor: =RGBA(51, 51, 51, 1)
                            HoverFill: =RGBA(255, 255, 255, 1)
                            MaxLength: =100
                            Mode: =TextMode.MultiLine
                            OnChange: =
                            PaddingLeft: =5
                            PressedBorderColor: =Self.BorderColor
                            PressedColor: =RGBA(51, 51, 51, 1)
                            PressedFill: =RGBA(255, 255, 255, 1)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =10
                            Width: =(Parent.Width - Self.X) / 2
                            X: =txtStageName_1.X
                            Y: =lblStageDesc_4.Y
                            ZIndex: =6

                        lblStageConditionHeader_1 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =30
                            PaddingLeft: =0
                            Size: =10
                            Text: ="Conditions"
                            Width: =txtStageName_1.X - Self.X
                            Wrap: =false
                            X: =bcProcessStage_4.X
                            Y: =txtStageDesc_1.Y + txtStageDesc_1.Height + 20
                            ZIndex: =7

                        lblStageCondition_1 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Condition"
                            Width: =120
                            X: =lblStageName_3.X
                            Y: =244
                            ZIndex: =8

                        ddlStageCondition_1 As dropdown:
                            BorderColor: =RGBA(166, 166, 166, 1)
                            BorderThickness: =1
                            ChevronBackground: =RGBA(255, 255, 255, 1)
                            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                            ChevronFill: =RGBA(33, 33, 33, 1)
                            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                            ChevronHoverFill: =RGBA(33, 33, 33, 1)
                            Color: =RGBA(51, 51, 51, 1)
                            Default: =_selectedStage.'Stage Condition'
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            DisplayMode: =If(_currentStageIndex < 2 || !allowUpdateConditionType, DisplayMode.Disabled, DisplayMode.Edit)
                            FocusedBorderThickness: =1
                            Font: =Font.'Segoe UI'
                            Height: =30
                            HoverBorderColor: =Self.BorderColor
                            HoverFill: =RGBA(243, 242, 241, 1)
                            Items: =Choices('Business Approval Stage Condition')
                            OnChange: |-
                                =UpdateContext({ conditionsCount: CountRows(_conditions)});
                                Switch(Self.Selected.Value,
                                
                                    //--- Case = If/Else ---
                                    'Business Approval Stage Condition'.'If/Else', 
                                    //if there are existing conditions, remove all except the first condition
                                    Collect(_removedConditions, 
                                        ShowColumns(Filter(_conditions, Path > 1), "ConditionId", "Path", "Target", "TargetData", "StaticValue", "TargetStage")
                                    );
                                    RemoveIf(_conditions, Path > 1);
                                    If(conditionsCount = 0, 
                                        ClearCollect(_conditions,
                                        { 
                                            ConditionId: "", Path: 1, Target: 'Business Approval Condition Target Data'.'Static value', 
                                            TargetData: Blank(), StaticValue: "", TargetStage: Blank(), IsDefault: false, IsParallel: false 
                                        })
                                    );
                                    Reset(radSwitchPaths_1),
                                    
                                    //--- Case = Switch ---
                                    'Business Approval Stage Condition'.Switch, 
                                    Collect(_conditions, 
                                        ForAll(Sequence(radSwitchPaths_1.Selected.Value - conditionsCount, conditionsCount + 1), 
                                        { 
                                            ConditionId: "", Path: Value, Target: 'Business Approval Condition Target Data'.'Static value',
                                            TargetData: Blank(), StaticValue: "", TargetStage: Blank(), IsDefault: false, IsParallel: false
                                        })
                                    );
                                    //set last condition as default for switch types
                                    Patch(_conditions, Last(_conditions), { IsDefault: true, StaticValue: "Default (Other values)"}),
                                
                                    //--- Case = None ---
                                    'Business Approval Stage Condition'.None, 
                                    //if there are any existing conditions, add them to the remove list
                                    If(conditionsCount > 0, 
                                        Collect(_removedConditions, ShowColumns(_conditions,  "ConditionId", "Path", "Target", "TargetData", "StaticValue", "TargetStage"));    
                                        Clear(_conditions)
                                    )
                                );
                                Reset(ddlStageOperand_1)
                            PaddingBottom: =5
                            PaddingLeft: =5
                            PaddingRight: =5
                            PaddingTop: =5
                            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                            PressedFill: =Self.HoverFill
                            SelectionColor: =Self.Color
                            SelectionFill: =RGBA(243, 242, 241, 1)
                            Size: =10
                            Width: =txtStageDesc_1.Width - If(btnResetConditions_1.Visible, btnResetConditions_1.Width + 20, 0)
                            X: =txtStageName_1.X
                            Y: =244
                            ZIndex: =9

                        imgWorkflowDiagram_2 As image:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledFill: =RGBA(0, 0, 0, 0)
                            FocusedBorderThickness: =4
                            Height: =If(Self.Visible, 70, 0)
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverFill: =RGBA(0, 0, 0, 0)
                            Image: |
                                ="data:image/svg+xml;utf8, " & 
                                Switch(radSwitchPaths_1.Selected.Value,
                                    3, EncodeUrl("<svg width='657' height='382' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='1718' y='254' width='657' height='382'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-1718 -254)'><path d='M1911.5 324 2048.5 257.5 2185.5 324 2048.5 390.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='1720.5' y='516.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1950.5' y='514.5' width='192' height='118' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M2048.52 390 2048.52 452.736 1816 452.736 1816 515.471' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M2048.01 390 2048.01 451.787 2046 451.787 2046 513.575' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='2181.5' y='514.5' width='191' height='118' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 61.7874 0 61.7874 228.498 123.575 228.498' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2048 390)'/></g></svg>"),
                                    4, EncodeUrl("<svg width='907' height='384' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='551' y='760' width='907' height='384'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-551 -760)'><path d='M870.5 830 1007.5 763.5 1144.5 830 1007.5 896.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='553.5' y='1024.5' width='192' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='790.5' y='1024.5' width='192' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M1006.71 896 1006.71 959.73 649 959.73 649 1023.46' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M1006.89 896 1006.89 959.729 886 959.729 886 1023.46' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='1027.5' y='1024.5' width='192' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1264.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 63.7293 0 63.7293 352.731 127.459 352.731' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 1007 896)'/><path d='M0 0 63.7293 0 63.7293 115.918 127.459 115.918' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 1007 896)'/></g></svg>"),
                                    5, EncodeUrl("<svg width='1144' height='374' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='1589' y='770' width='1144' height='374'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-1589 -770)'><path d='M2024.5 840 2161 773.5 2297.5 840 2161 906.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='1591.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1828.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M2160.14 906 2160.14 964.793 1686 964.793 1686 1023.59' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M2160.07 906 2160.07 964.793 1923 964.793 1923 1023.59' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='2065.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='2302.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 58.7933 0 58.7933 237.069 117.587 237.069' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2161 906)'/><path d='M0 0 58.7933 0 58.7933 0.000360892 117.586 0.000360892' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2161 906)'/><rect x='2539.5' y='1024.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M0 0 58.7934 0 58.7934 474.138 117.587 474.138' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 2161 906)'/></g></svg>"),
                                    EncodeUrl("<svg width='522' height='386' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' overflow='hidden'><defs><clipPath id='clip0'><rect x='752' y='250' width='522' height='386'/></clipPath></defs><g clip-path='url(#clip0)' transform='translate(-752 -250)'><path d='M870.5 320.5 1007.5 253.5 1144.5 320.5 1007.5 387.5Z' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><rect x='754.5' y='516.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><rect x='1080.5' y='516.5' width='191' height='117' stroke='#000000' stroke-width='4.58333' stroke-miterlimit='8' fill='none'/><path d='M1007.36 387 1007.36 451.678 850 451.678 850 516.356' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/><path d='M0 0 64.6777 0 64.6777 168.735 129.355 168.735' stroke='#000000' stroke-width='2.29167' stroke-miterlimit='8' fill='none' fill-rule='evenodd' transform='matrix(1.83697e-16 1 1 -1.83697e-16 1007 387)'/></g></svg>"))
                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            Visible: =ddlStageCondition_1.Selected.Value <> 'Business Approval Stage Condition'.None
                            Width: =300
                            X: =radSwitchPaths_1.X
                            Y: =radSwitchPaths_1.Y + radSwitchPaths_1.Height + 2
                            ZIndex: =10

                        radSwitchPaths_1 As radio:
                            BorderColor: =RGBA(51, 51, 51, 1)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            Default: =If(Self.Visible, Max(_selectedStage.Paths,3))
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisplayMode: =ddlStageCondition_1.DisplayMode
                            FocusedBorderThickness: =0
                            Font: =Font.'Segoe UI'
                            Height: =If(Self.Visible, 30, 0)
                            HoverColor: =RGBA(51, 51, 51, 1)
                            HoverFill: =RGBA(0, 0, 0, 0)
                            Items: =[ 2, 3, 4, 5]
                            Layout: =Layout.Horizontal
                            OnChange: |
                                =With({ count: CountRows(_conditions), newCount: radSwitchPaths_1.Selected.Value },
                                    If(count > newCount, 
                                        //new paths is less than current - remove last n conditions
                                        //push paths that are to be removed into temp stack then remove
                                        Collect(_removedConditions, 
                                            ShowColumns(Filter(_conditions, Path > newCount), "ConditionId", "Path", "Target", "TargetData", "StaticValue", "TargetStage")
                                        );
                                        RemoveIf(_conditions, Path > newCount),
                                
                                        //new paths is more than current - add conditions
                                        Collect(_conditions,
                                            ForAll(Sequence(newCount - count, count + 1),                 
                                                Coalesce(
                                                    LookUp(_removedConditions, Path = Value),
                                                    { 
                                                        ConditionId: Blank(), TargetData: Blank(), StaticValue: "", TargetStage: Blank(),
                                                        Path: Value, Text: "Path " & Value, 
                                                        Target: 'Business Approval Condition Target Data'.'Static value',
                                                        IsDefault: false, IsParallel: false
                                                    }
                                                )
                                            )
                                        );
                                
                                        //pop from temp stack for any conditions that has been restored back
                                        RemoveIf(_removedConditions, Path <= newCount);
                                    );
                                    //clear any condition from default, if exist
                                    UpdateIf(_conditions, IsDefault, { IsDefault: false, StaticValue: ""});
                                    //update last path to default
                                    Patch(_conditions, Last(_conditions), { IsDefault: true, StaticValue: "Default (Other values)" })
                                );
                            PaddingBottom: =0
                            PaddingTop: =2
                            PressedColor: =RGBA(51, 51, 51, 1)
                            PressedFill: =RGBA(0, 0, 0, 0)
                            RadioBorderColor: =RGBA(51, 51, 51, 1)
                            RadioSelectionFill: =RGBA(0, 120, 212, 1)
                            RadioSize: =25
                            Size: =10
                            Visible: =lblSwitchPaths_2.Visible
                            Width: =ddlStageCondition_1.Width
                            X: =txtStageName_1.X
                            Y: =lblSwitchPaths_2.Y
                            ZIndex: =11

                        lblSwitchPaths_2 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Paths"
                            Visible: =ddlStageCondition_1.Selected.Value = 'Business Approval Stage Condition'.Switch
                            Width: =120
                            X: =lblStageCondition_1.X
                            Y: =lblStageCondition_1.Y + lblStageCondition_1.Height + 10
                            ZIndex: =12

                        lblFirstStageNoCondition_1 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="This is the first stage for the process. Conditional rules are not applicable."
                            Visible: =_currentStageIndex < 2
                            Width: =lblStageCondition_1.Width + ddlStageCondition_1.Width
                            X: =lblStageCondition_1.X
                            Y: =lblStageCondition_1.Y + lblStageCondition_1.Height + 10
                            ZIndex: =13

                        lblStageConditionSource_1 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Source"
                            Visible: =ddlStageCondition_1.Selected.Value <> 'Business Approval Stage Condition'.None && ddlStageCondition_1.Visible
                            Width: =120
                            X: =lblStageName_3.X
                            Y: =imgWorkflowDiagram_2.Y + imgWorkflowDiagram_2.Height + 10
                            ZIndex: =14

                        ddlStageConditionSource_1 As dropdown:
                            BorderColor: =RGBA(166, 166, 166, 1)
                            BorderThickness: =1
                            ChevronBackground: =RGBA(255, 255, 255, 1)
                            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                            ChevronFill: =RGBA(33, 33, 33, 1)
                            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                            ChevronHoverFill: =RGBA(33, 33, 33, 1)
                            Color: =RGBA(51, 51, 51, 1)
                            Default: =_selectedStage.'Source Data Type'
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            DisplayMode: =If(_currentStageIndex < 2, DisplayMode.Disabled, DisplayMode.Edit)
                            FocusedBorderThickness: =1
                            Font: =Font.'Segoe UI'
                            Height: =30
                            HoverBorderColor: =Self.BorderColor
                            HoverFill: =RGBA(243, 242, 241, 1)
                            Items: =Choices('Business Approval Condition Source Data')
                            OnChange: =Reset(ddlStageOperand_1)
                            PaddingBottom: =5
                            PaddingLeft: =5
                            PaddingRight: =5
                            PaddingTop: =5
                            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                            PressedFill: =Self.HoverFill
                            SelectionColor: =Self.Color
                            SelectionFill: =RGBA(243, 242, 241, 1)
                            Size: =10
                            Visible: =lblStageConditionSource_1.Visible
                            Width: =txtStageDesc_1.Width
                            X: =ddlStageCondition_1.X
                            Y: =lblStageConditionSource_1.Y
                            ZIndex: =15

                        lblRequestDataCondition_2 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =If(Self.Visible, 30, 0)
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Request Data"
                            Visible: =ddlStageConditionSource_1.Selected.Value = 'Business Approval Condition Source Data'.'Request Data' && ddlStageConditionSource_1.Visible
                            Width: =120
                            X: =lblStageName_3.X
                            Y: =lblStageConditionSource_1.Y + lblStageConditionSource_1.Height + If(Self.Visible, 10, 0)
                            ZIndex: =16

                        ddlRequestDataCondition_1 As dropdown:
                            BorderColor: =RGBA(166, 166, 166, 1)
                            BorderThickness: =1
                            ChevronBackground: =RGBA(255, 255, 255, 1)
                            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                            ChevronFill: =RGBA(33, 33, 33, 1)
                            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                            ChevronHoverFill: =RGBA(33, 33, 33, 1)
                            Color: =RGBA(51, 51, 51, 1)
                            Default: =_selectedStage.'Source Data'.Name
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            DisplayMode: =If(_currentStageIndex < 2, DisplayMode.Disabled, DisplayMode.Edit)
                            FocusedBorderThickness: =1
                            Font: =Font.'Segoe UI'
                            Height: =lblRequestDataCondition_2.Height
                            HoverBorderColor: =Self.BorderColor
                            HoverFill: =RGBA(243, 242, 241, 1)
                            Items: |-
                                =Filter(
                                    Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                                    Process.'Business Approval Process' = _selectedProcess.'Business Approval Process'
                                )
                            OnChange: |-
                                =UpdateIf(_conditions, true, { TargetData: Blank() }) //clear all target data value if exists
                            PaddingBottom: =5
                            PaddingLeft: =5
                            PaddingRight: =5
                            PaddingTop: =5
                            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                            PressedFill: =Self.HoverFill
                            SelectionColor: =Self.Color
                            SelectionFill: =RGBA(243, 242, 241, 1)
                            Size: =10
                            Visible: =lblRequestDataCondition_2.Visible
                            Width: =txtStageDesc_1.Width
                            X: =ddlStageCondition_1.X
                            Y: =lblRequestDataCondition_2.Y
                            ZIndex: =17

                        lblRequestDataIsEmpty_1 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(255, 0, 0, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            Fill: =RGBA(255, 255, 255, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =ddlRequestDataCondition_1.Height
                            Size: =10
                            Text: ="No request data available. Create new request data in the process edit screen."
                            Visible: |-
                                =With({ condData:
                                     Filter(
                                        Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                                        Process.'Business Approval Process' = _selectedProcess.'Business Approval Process'
                                    )},
                                    IsEmpty(condData) && ddlStageConditionSource_1.Visible && 
                                    ddlStageConditionSource_1.Selected.Value = 'Business Approval Condition Source Data'.'Request Data'
                                )
                            Width: =ddlRequestDataCondition_1.Width
                            X: =ddlRequestDataCondition_1.X
                            Y: =ddlRequestDataCondition_1.Y
                            ZIndex: =18

                        lblRequestDataDetails_1 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            PaddingLeft: =12
                            Size: =10
                            Text: |-
                                ="Default value: " & Coalesce(ddlRequestDataCondition_1.Selected.'Default Value', "Not specified.")
                            Visible: =ddlRequestDataCondition_1.Visible && !lblRequestDataIsEmpty_1.Visible
                            Width: =Parent.Width - Self.X - 100
                            X: =ddlRequestDataCondition_1.X + ddlRequestDataCondition_1.Width
                            Y: =ddlRequestDataCondition_1.Y
                            ZIndex: =19

                        lblParallelConditions_1 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Switch conditions are parallel rules. You can have one or more paths with the same condition to create parallel paths."
                            Visible: =galConditions_1.Visible && ddlStageCondition_1.Selected.Value = 'Business Approval Stage Condition'.Switch
                            Width: =galConditions_1.Width
                            X: =lblStageName_3.X
                            Y: =galConditions_1.Y + galConditions_1.Height
                            ZIndex: =20

                        galConditions_1 As gallery.galleryVertical:
                            BorderColor: =RGBA(166, 166, 166, 1)
                            Height: =120
                            Items: =SortByColumns(_conditions, "Path", SortOrder.Ascending)
                            Layout: =Layout.Vertical
                            TemplatePadding: =0
                            TemplateSize: =118
                            Visible: |-
                                =CountRows(Self.AllItems) > 0 && ddlStageCondition_1.Selected.Value <> 'Business Approval Stage Condition'.None && 
                                ddlStageOperand_1.Selected.Value <> 'Business Approval Condition Operand'.'Is Blank' &&
                                ddlStageOperand_1.Selected.Value <> 'Business Approval Condition Operand'.'Is Not Blank'
                            Width: |-
                                =If(ddlStageCondition_1.Selected.Value = 'Business Approval Stage Condition'.'If/Else',
                                    txtStageName_1.Width,
                                    Parent.Width - Self.X - 20
                                )
                            WrapCount: =CountRows(Self.AllItems)
                            X: =If(ddlStageCondition_1.Selected.Value = 'Business Approval Stage Condition'.'If/Else', txtStageName_1.X, lblStageName_3.X)
                            Y: =lblStageOperand_1.Y + lblStageOperand_1.Height + 20
                            ZIndex: =21

                            Rectangle3_2 As rectangle:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                DisplayMode: =DisplayMode.Disabled
                                Fill: =RGBA(230, 230, 230, 1)
                                FocusedBorderThickness: =4
                                Height: =Parent.TemplateHeight
                                HoverFill: =RGBA(105, 121, 126, 1)
                                OnSelect: =Select(Parent)
                                PressedFill: =RGBA(105, 121, 126, 1)
                                Width: =Parent.TemplateWidth - 2
                                ZIndex: =1

                            lblConditionTarget_1 As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(51, 51, 51, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                Height: =30
                                PaddingLeft: =12
                                Size: =9
                                Text: |-
                                    =If(ThisItem.IsDefault, "Default", "If " & 
                                        If(ddlRequestDataCondition_1.Visible, ddlRequestDataCondition_1.Selected.Name, ddlStageConditionSource_1.Selected.Value) & " " &
                                        ddlStageOperand_1.Selected.Value
                                    )
                                Width: =Parent.TemplateWidth
                                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                                Y: =5
                                ZIndex: =2

                            ddlConditionTarget_2 As dropdown:
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderThickness: =1
                                ChevronBackground: =RGBA(255, 255, 255, 1)
                                ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                                ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                                ChevronFill: =RGBA(33, 33, 33, 1)
                                ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                                ChevronHoverFill: =RGBA(33, 33, 33, 1)
                                Color: =RGBA(51, 51, 51, 1)
                                Default: =If(Self.DisplayMode = DisplayMode.Disabled, 'Business Approval Condition Target Data'.'Static value', ThisItem.Target)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                DisabledFill: =RGBA(244, 244, 244, 1)
                                DisplayMode: =txtTargetStatic_2.DisplayMode
                                FocusedBorderThickness: =1
                                Font: =Font.'Segoe UI'
                                Height: =30
                                HoverBorderColor: =Self.BorderColor
                                HoverFill: =RGBA(243, 242, 241, 1)
                                Items: =Choices('Business Approval Condition Target Data')
                                OnChange: |-
                                    =Patch(_conditions, ThisItem, { Target: Self.Selected.Value, TargetData: Blank() })
                                PaddingBottom: =5
                                PaddingLeft: =5
                                PaddingRight: =5
                                PaddingTop: =5
                                PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                                PressedFill: =Self.HoverFill
                                SelectionColor: =Self.Color
                                SelectionFill: =RGBA(243, 242, 241, 1)
                                Size: =10
                                Width: =Min(txtStageName_1.Width, Parent.TemplateWidth - 20)
                                X: =Parent.TemplateWidth / 2 - Self.Width / 2
                                Y: =lblConditionTarget_1.Y + lblConditionTarget_1.Height
                                ZIndex: =3

                            ddlTargetRequestData_1 As dropdown:
                                AllowEmptySelection: =true
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderThickness: =1
                                ChevronBackground: =RGBA(255, 255, 255, 1)
                                ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                                ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                                ChevronFill: =RGBA(33, 33, 33, 1)
                                ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                                ChevronHoverFill: =RGBA(33, 33, 33, 1)
                                Color: =RGBA(51, 51, 51, 1)
                                Default: =ThisItem.TargetData.Name
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                DisabledFill: =RGBA(244, 244, 244, 1)
                                FocusedBorderThickness: =1
                                Font: =Font.'Segoe UI'
                                Height: =If(Self.Visible, 30, 0)
                                HoverBorderColor: =Self.BorderColor
                                HoverFill: =RGBA(243, 242, 241, 1)
                                Items: |-
                                    =Filter(
                                        Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                                        Process.'Business Approval Process' = _selectedProcess.'Business Approval Process' && 
                                        'Business Approval Data' <> ddlRequestDataCondition_1.Selected.'Business Approval Data' &&
                                        'Data Type' = ddlRequestDataCondition_1.Selected.'Data Type'
                                    )
                                OnChange: |-
                                    =Patch(_conditions, ThisItem, { TargetData: Self.Selected, StaticValue: Blank()})
                                PaddingBottom: =5
                                PaddingLeft: =5
                                PaddingRight: =5
                                PaddingTop: =5
                                PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                                PressedFill: =Self.HoverFill
                                SelectionColor: =Self.Color
                                SelectionFill: =RGBA(243, 242, 241, 1)
                                Size: =10
                                Visible: =ddlConditionTarget_2.Selected.Value = 'Business Approval Condition Target Data'.'Request Data' && ThisItem.IsDefault = false
                                Width: =ddlConditionTarget_2.Width
                                X: =ddlConditionTarget_2.X
                                Y: =ddlConditionTarget_2.Y + ddlConditionTarget_2.Height + 10
                                ZIndex: =4

                            txtTargetStatic_2 As text:
                                BorderColor: =RGBA(166, 166, 166, 1)
                                Clear: =true
                                Color: =RGBA(51, 51, 51, 1)
                                Default: =ThisItem.StaticValue
                                DelayOutput: =true
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                DisabledFill: =RGBA(244, 244, 244, 1)
                                DisplayMode: =If(ThisItem.IsDefault, DisplayMode.Disabled, DisplayMode.Edit)
                                FocusedBorderThickness: =1
                                Font: =Font.'Segoe UI'
                                Height: =30
                                HoverBorderColor: =Self.BorderColor
                                HoverColor: =RGBA(51, 51, 51, 1)
                                HoverFill: =RGBA(255, 255, 255, 1)
                                MaxLength: =100
                                OnChange: |-
                                    =Patch(_conditions, ThisItem, { StaticValue: Self.Text, TargetData: Blank() })
                                PaddingLeft: =5
                                PressedBorderColor: =Self.BorderColor
                                PressedColor: =RGBA(51, 51, 51, 1)
                                PressedFill: =RGBA(255, 255, 255, 1)
                                RadiusBottomLeft: =0
                                RadiusBottomRight: =0
                                RadiusTopLeft: =0
                                RadiusTopRight: =0
                                Size: =10
                                Visible: =!ddlTargetRequestData_1.Visible
                                Width: =ddlConditionTarget_2.Width
                                X: =ddlConditionTarget_2.X
                                Y: =ddlConditionTarget_2.Y + ddlConditionTarget_2.Height + 10
                                ZIndex: =5

                            lblStageTargetRequestDataNotFound_1 As label:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(51, 51, 51, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                Fill: =RGBA(230, 230, 230, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                Height: =ddlTargetRequestData_1.Height
                                OnSelect: =Select(Parent)
                                Size: =10
                                Text: ="No other data field found of similar data type for " & ddlRequestDataCondition_1.Selected.Name & " (" & ddlRequestDataCondition_1.Selected.'Data Type' & ")"
                                Visible: |-
                                    =With({ conditionData: Filter(
                                        Filter('Business Approval Data', 'Business Approval Data (Views)'.'Active Business Approval Data'),
                                        Process.'Business Approval Process' = _selectedProcess.'Business Approval Process' && 
                                        'Business Approval Data' <> ddlRequestDataCondition_1.Selected.'Business Approval Data' &&
                                        'Data Type' = ddlRequestDataCondition_1.Selected.'Data Type')},
                                        ddlTargetRequestData_1.Visible && IsEmpty(conditionData)
                                    )
                                Width: =ddlTargetRequestData_1.Width
                                X: =ddlTargetRequestData_1.X
                                Y: =ddlTargetRequestData_1.Y
                                ZIndex: =6

                            lblIsParallel_1 As label:
                                Align: =Align.Center
                                BorderColor: =RGBA(73, 84, 88, 1)
                                BorderThickness: =1
                                Color: =RGBA(51, 51, 51, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                FontWeight: =FontWeight.Semibold
                                Height: =lblConditionTarget_1.Height - 5
                                Size: =lblConditionTarget_1.Size
                                Text: ="="
                                Tooltip: ="Parallel paths"
                                Visible: |-
                                    =!IsBlank(LookUp(_conditions, Path <> ThisItem.Path && Target = ThisItem.Target && IsDefault = false &&
                                        If(ThisItem.Target = 'Business Approval Condition Target Data'.'Static value',
                                            StaticValue = txtTargetStatic_2.Text,
                                            TargetData.'Business Approval Data' = ddlTargetRequestData_1.Selected.'Business Approval Data')
                                        )
                                    ) && !ThisItem.IsDefault
                                Width: =Self.Height
                                X: =ddlConditionTarget_2.X
                                Y: =lblConditionTarget_1.Y
                                ZIndex: =7

                        lblStageOperand_1 As label:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            Height: =30
                            PaddingLeft: =12
                            Size: =10
                            Text: ="Operand"
                            Visible: =lblStageConditionSource_1.Visible
                            Width: =120
                            X: =lblStageName_3.X
                            Y: =lblRequestDataCondition_2.Y + lblRequestDataCondition_2.Height + 10
                            ZIndex: =22

                        ddlStageOperand_1 As dropdown:
                            BorderColor: =RGBA(166, 166, 166, 1)
                            BorderThickness: =1
                            ChevronBackground: =RGBA(255, 255, 255, 1)
                            ChevronDisabledBackground: =RGBA(244, 244, 244, 1)
                            ChevronDisabledFill: =RGBA(166, 166, 166, 1)
                            ChevronFill: =RGBA(33, 33, 33, 1)
                            ChevronHoverBackground: =RGBA(212, 212, 212, 1)
                            ChevronHoverFill: =RGBA(33, 33, 33, 1)
                            Color: =RGBA(51, 51, 51, 1)
                            Default: |-
                                =With({ operand: _selectedStage.Operand}, 
                                    If(IsBlank(operand) || ddlStageCondition_1.Selected.Value = 'Business Approval Stage Condition'.Switch, 
                                        'Business Approval Condition Operand'.'Equals (=)', operand
                                    )
                                )
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            DisplayMode: |-
                                =If(
                                    ddlStageCondition_1.Selected.Value = 'Business Approval Stage Condition'.Switch ||
                                    ddlStageConditionSource_1.Selected.Value = 'Business Approval Condition Source Data'.'Previous Node Outcome' ||
                                    lblRequestDataIsEmpty_1.Visible, 
                                    DisplayMode.Disabled, DisplayMode.Edit
                                )
                            FocusedBorderThickness: =1
                            Font: =Font.'Segoe UI'
                            Height: =30
                            HoverBorderColor: =Self.BorderColor
                            HoverFill: =RGBA(243, 242, 241, 1)
                            Items: |-
                                =If(ddlStageConditionSource_1.Selected.Value = 'Business Approval Condition Source Data'.'Request Data',
                                    LookUp(_operands, ddlRequestDataCondition_1.Selected.'Data Type' in type).operands,
                                    [ 'Business Approval Condition Operand'.'Equals (=)' ]
                                )
                            OnChange: |-
                                =If(Self.Selected.Value = 'Business Approval Condition Operand'.'Is Blank' || 
                                Self.Selected.Value = 'Business Approval Condition Operand'.'Is Not Blank', 
                                    Patch(_conditions, First(_conditions), { StaticValue: ""})
                                )
                            PaddingBottom: =5
                            PaddingLeft: =5
                            PaddingRight: =5
                            PaddingTop: =5
                            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                            PressedFill: =Self.HoverFill
                            SelectionColor: =Self.Color
                            SelectionFill: =RGBA(243, 242, 241, 1)
                            Size: =10
                            Visible: =lblStageConditionSource_1.Visible
                            Width: =txtStageDesc_1.Width
                            X: =ddlStageCondition_1.X
                            Y: =lblStageOperand_1.Y
                            ZIndex: =23

                        btnResetConditions_1 As button:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            DisabledFill: =RGBA(244, 244, 244, 1)
                            Fill: =RGBA(105, 121, 126, 1)
                            FocusedBorderColor: =ColorFade(Self.Fill, -75%)
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Semibold
                            Height: =30
                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                            HoverColor: =RGBA(255, 255, 255, 1)
                            HoverFill: =ColorFade(RGBA(105, 121, 126, 1), -10%)
                            OnSelect: |-
                                =If(Self.Text = "Edit",
                                    //saves current condition in memory
                                    ClearCollect(_savedConditions, _conditions);
                                    UpdateContext({ allowUpdateConditionType: true, isCleared: true }),
                                
                                    //restore saved conditions back from memory
                                    ClearCollect(_conditions, _savedConditions);
                                    Clear(_savedConditions); Clear(_removedConditions);
                                    Reset(ddlStageCondition_1);
                                    UpdateContext({ allowUpdateConditionType: false, isCleared: false })
                                )
                            PressedBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -50%)
                            PressedColor: =RGBA(255, 255, 255, 1)
                            PressedFill: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                            RadiusBottomLeft: =0
                            RadiusBottomRight: =0
                            RadiusTopLeft: =0
                            RadiusTopRight: =0
                            Size: =10
                            Text: =If(isCleared, "Reset", "Edit")
                            Visible: =(!allowUpdateConditionType || isCleared) && _currentStageIndex > 1
                            Width: =90
                            X: =ddlStageCondition_1.X + ddlStageCondition_1.Width + 20
                            Y: =244
                            ZIndex: =24

                        lblResetConditions_2 As label:
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =4
                            Font: =Font.'Segoe UI'
                            FontWeight: =FontWeight.Lighter
                            Height: =3
                            PaddingLeft: =0
                            PaddingRight: =0
                            Size: =10
                            Text: |-
                                ="Currently editing a stage with Conditions defined. Click 'Edit' to change and 'Reset' to undo. Warning: Removing conditions removes the corresponding paths and its nodes."
                            Visible: =btnResetConditions_1.Visible
                            Width: =txtStageName_1.Width
                            X: =txtStageName_1.X
                            Y: =lblStageConditionHeader_1.Y
                            ZIndex: =25

                        Dependencies_1 As groupContainer:
                            Height: =Min(lblRequestDataDetails_1.Y - 20, 300)
                            Visible: =CountRows(galStageDeps_1.AllItems) > 0
                            Width: =Parent.Width - Self.X - 20
                            X: =txtStageName_1.X + txtStageName_1.Width + 20
                            Y: =txtStageName_1.Y
                            ZIndex: =26

                            galStageDeps_1 As gallery.galleryVertical:
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderThickness: =1
                                Height: =Min(Parent.Height - Self.Y, CountRows(Self.AllItems) * Self.TemplateHeight)
                                Items: =_selectedStage.'Business Approval Conditions (cat_BusinessApprovalCondition_GoToStage_c)'
                                Layout: =Layout.Vertical
                                TemplatePadding: =0
                                TemplateSize: =30
                                Width: =Parent.Width - Self.X - 10
                                X: =5
                                Y: =tblStageDeps_1.Y + tblStageDeps_1.Height
                                ZIndex: =1

                                lblStageDepStageName_1 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(51, 51, 51, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Lighter
                                    Height: =30
                                    OnSelect: =Select(Parent)
                                    Size: =10
                                    Text: =ThisItem.Node.'Stage Name Value'
                                    Tooltip: =Self
                                    Width: =Parent.Width / 4
                                    Wrap: =false
                                    ZIndex: =1

                                lblStageDepNodeName_1 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(51, 51, 51, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Lighter
                                    Height: =30
                                    OnSelect: =Select(Parent)
                                    Size: =10
                                    Text: =ThisItem.Node.Name
                                    Tooltip: =Self.Text
                                    Width: =Parent.Width / 4
                                    Wrap: =false
                                    X: =lblStageDepStageName_1.Width
                                    ZIndex: =2

                                lblStageDepNodeCond_1 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(51, 51, 51, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Lighter
                                    Height: =30
                                    OnSelect: =Select(Parent)
                                    Size: =10
                                    Text: =ThisItem.Node.'Source Data Name Value' & " " & ThisItem.Node.Operand & " " & ThisItem.'Condition Value Display'
                                    Tooltip: =Self.Text
                                    Width: =Parent.Width / 2
                                    Wrap: =false
                                    X: =lblStageDepNodeName_1.X + lblStageDepNodeName_1.Width
                                    ZIndex: =3

                            tblStageDeps_1 As TableHeader:
                                ColumnOnClick: ="Text"
                                Columns: |-
                                    =Table(
                                        { Index: 1, Text: "Stage", Column: "Stage", Width: Self.Width / 4, Offset: 0, EnableSort: false },    
                                        { Index: 2, Text: "Node", Column: "Name", Width: Self.Width / 4, Offset: -Self.Width / 4, EnableSort: false },
                                        { Index: 3, Text: "Condition", Column: "Condition", Width: Self.Width / 2, Offset: -Self.Width / 2, EnableSort: false }
                                    )
                                EnableSort: =false
                                Width: =galStageDeps_1.Width
                                X: =5
                                Y: =lblStageHasDeps_1.Height
                                ZIndex: =2

                            lblStageHasDeps_1 As label:
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(51, 51, 51, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                FocusedBorderThickness: =4
                                Font: =Font.'Segoe UI'
                                FontWeight: =FontWeight.Lighter
                                Height: =30
                                Size: =10
                                Text: ="This stage has the following dependencies and cannot be deleted until the dependencies are removed."
                                Width: =Parent.Width
                                ZIndex: =3

                        ConfirmDialog_8 As ConfirmDialog:
                            ConfirmText: ="Deleting Stage - " & _selectedStage.Name & ". This will also delete all approval nodes in this stage and it cannot be undone. Are you sure?"
                            Height: =Parent.Height
                            OnClick: |-
                                =If(IsConfirmed,
                                    UpdateContext({ busyMessage: "Deleting Stage - " & _selectedStage.Name });
                                    Set(_isBusy, true);
                                
                                    Concurrent(
                                        //remove stage
                                        Remove('Business Approval Stages', _selectedStage),
                                
                                        //remove nodes
                                        RemoveIf('Business Approval Nodes', Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage'),
                                
                                        //remove node conditions
                                        RemoveIf('Business Approval Conditions', 
                                            Node.'Business Approval Node' in 
                                            _selectedStage.'Business Approval Nodes (cat_BusinessApprovalNode_Stage_cat_Busine)'.'Business Approval Node'
                                        ); 
                                        //remove stage conditions
                                        RemoveIf('Business Approval Conditions', Stage.'Business Approval Stage' = _selectedStage.'Business Approval Stage')
                                    );
                                
                                    Set(_selectedStage, Blank());
                                    Set(_isBusy, false);
                                    Set(_showConfirm, false);
                                    Back(),
                                    Set(_showConfirm, false)
                                )
                            Visible: =_showConfirm
                            Width: =Parent.Width
                            ZIndex: =27

                        BusyScreen_8 As BusyScreen:
                            BusyMessage: =busyMessage
                            Fill: =RGBA(255, 255, 255, 0.8)
                            Height: =Parent.Height
                            Visible: =_isBusy
                            Width: =Parent.Width
                            ZIndex: =28

            Container12_8 As groupContainer.verticalAutoLayoutContainer:
                Fill: =RGBA(255, 255, 255, 1)
                FillPortions: =0
                Height: =72
                LayoutAlignItems: =LayoutAlignItems.Center
                LayoutGap: =12
                LayoutMinHeight: =72
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingLeft: =20
                ZIndex: =3

                btnBack_6 As Button:
                    BorderColor: =ColorValue(AppTheme.palette.neutralPrimary)
                    BorderRadius: =2
                    BorderStyle: =BorderStyle.Solid
                    BorderThickness: =1
                    ButtonType: ='Button.ButtonType'.Standard
                    DisplayMode: =DisplayMode.Edit
                    FillColor: =ColorValue(AppTheme.palette.white)
                    FontWeight: =FontWeight.Semibold
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =96
                    OnSelect: =Back()
                    Text: ="Back"
                    Width: =96
                    X: =0
                    Y: =0
                    ZIndex: =1

                btnNext_6 As Button:
                    BorderRadius: =2
                    ButtonType: ='Button.ButtonType'.Primary
                    DisplayMode: |+
                        =If(IsBlank(_selectedProcess),DisplayMode.Disabled,DisplayMode.Edit)
                        
                    FontWeight: =FontWeight.Semibold
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =96
                    OnSelect: |-
                        =Set(_isBusy, true);
                        Navigate(scrWizardPublishProcess);
                    Text: ="Save & Next"
                    Visible: =true
                    Width: =96
                    X: =0
                    Y: =0
                    ZIndex: =2

